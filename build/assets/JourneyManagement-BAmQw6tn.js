import{j as e}from"./radix-vendor-BV-zUPZ_.js";import{a as g}from"./react-vendor-BK8AH302.js";import{aQ as _,aP as z,bd as W,ar as ee,bH as K,aW as H,bJ as Q,b4 as se,at as ne,bq as F,ax as te,aN as le,bQ as ae,aC as P,aR as de,ah as oe,aM as re,bm as Y,bS as G,bT as ce,am as V,bU as Z,bR as X,ay as xe,bV as me,bW as he,ap as be,aw as ue,bX as pe,aS as ge,bI as fe,bY as je,bZ as Ne,b0 as ve,b1 as we,b_ as ye,au as Te,ak as ke,bB as De}from"./ui-vendor-DgaPPGCl.js";import{B as w,d as Me}from"./index-CcmsAmAk.js";import{M as Se}from"./MapboxMap-B-WIlV8J.js";import"./mapbox-gl-BnguMuRq.js";import"./map-vendor-B8JKxxRh.js";import"./configService-BP__dzM5.js";import"./mapboxConfig-B9kHtw8J.js";function Je({id:s,title:n,date:o,price:x,status:m,onClick:c}){const t=a=>{switch(a){case"draft":return"bg-slate-100 text-slate-600 border-slate-200";case"published":return"bg-blue-100 text-blue-700 border-blue-200";case"allocated":return"bg-purple-100 text-purple-700 border-purple-200";case"in-progress":return"bg-orange-100 text-orange-700 border-orange-200";case"completed":return"bg-green-100 text-green-700 border-green-200";default:return"bg-gray-100 text-gray-700"}},d=a=>{switch(a){case"in-progress":return"ON ROUTE";default:return a.toUpperCase()}};return e.jsx("div",{onClick:c,className:"group bg-white border border-slate-200 rounded-lg shadow-sm hover:shadow-md transition-all cursor-pointer relative overflow-hidden",children:e.jsxs("div",{className:"p-4 flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center text-blue-600 shrink-0",children:e.jsx(_,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide border ${t(m)}`,children:d(m)}),e.jsxs("span",{className:"text-xs text-slate-400 font-mono",children:["#",s]})]}),e.jsx("h4",{className:"font-bold text-slate-900 text-[15px] leading-tight mb-1",children:n}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[e.jsx(z,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:o})]})]})]}),e.jsxs("div",{className:"text-right pl-4 border-l border-slate-100 md:border-l-0 md:pl-0",children:[e.jsxs("div",{className:"text-xl font-bold text-slate-900",children:["Â£",x.toFixed(2)]}),e.jsx("div",{className:"text-[10px] text-slate-500 uppercase tracking-wide font-bold",children:"Total Payout"})]})]})})}function Ce({journey:s,onBack:n,onStatusChange:o}){const[x,m]=g.useState("schedule"),c=()=>{if(s.status==="draft")return null;let t="",d="",a="bg-blue-50 border-blue-200 text-blue-900";if(s.status==="allocated")t="You've been allocated to this journey",d="AnyVan will pay you directly for this journey upon completion of all pickups and deliveries.";else if(s.status==="published")t="Journey Published to Marketplace",d="Waiting for drivers to accept. You will be notified when allocated.",a="bg-yellow-50 border-yellow-200 text-yellow-900";else if(s.status==="completed")t="Journey Completed",d="All jobs have been marked as complete. Payout is processing.",a="bg-green-50 border-green-200 text-green-900";else return null;return e.jsxs("div",{className:`mb-6 p-4 rounded-lg border ${a} text-sm`,children:[e.jsx("div",{className:"font-bold mb-1",children:t}),e.jsx("div",{children:d}),s.status==="allocated"&&s.driverName&&e.jsxs("div",{className:"flex items-center gap-4 mt-3 pt-3 border-t border-blue-200/50",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-bold uppercase",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"})," ",s.vehicleReg||"No Reg"]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-bold uppercase",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"})," ",s.driverName]}),e.jsxs("button",{className:"ml-auto text-blue-600 hover:underline",children:[e.jsx(K,{className:"w-3 h-3 inline mr-1"})," Edit"]})]})]})};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsxs("div",{className:"border-b border-slate-200 p-6 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("button",{onClick:n,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(W,{className:"w-5 h-5 text-slate-500"})}),e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Journey Details"})]}),c(),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"text-xs font-bold bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded border border-slate-200",children:s.id})}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-1",children:s.title}),e.jsxs("div",{className:"text-3xl font-bold text-slate-900",children:["Â£",s.price.toFixed(2)]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[s.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsxs(w,{variant:"outline",className:"text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"})," Delete"]}),e.jsxs(w,{variant:"outline",children:[e.jsx(K,{className:"w-4 h-4 mr-2"})," Edit"]}),e.jsxs(w,{className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>o("published"),children:[e.jsx(H,{className:"w-4 h-4 mr-2"})," Publish to Marketplace"]})]}),s.status==="published"&&e.jsxs(e.Fragment,{children:[e.jsxs(w,{variant:"outline",onClick:()=>o("draft"),children:[e.jsx(Q,{className:"w-4 h-4 mr-2"})," Unpublish"]}),e.jsxs(w,{variant:"outline",children:[e.jsx(se,{className:"w-4 h-4 mr-2"})," View in Marketplace"]}),e.jsxs(w,{className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>o("allocated"),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"})," Allocate Driver"]})]}),(s.status==="allocated"||s.status==="in-progress")&&e.jsxs(e.Fragment,{children:[e.jsxs(w,{variant:"outline",className:"text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"})," Deallocate"]}),e.jsxs(w,{className:"bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx(F,{className:"w-4 h-4 mr-2"})," Live Tracking"]}),e.jsxs(w,{className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>o("completed"),children:[e.jsx(te,{className:"w-4 h-4 mr-2"})," Complete Journey"]})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"grid lg:grid-cols-3 gap-0 min-h-full",children:[e.jsxs("div",{className:"lg:col-span-1 p-6 border-r border-slate-200 bg-slate-50/50",children:[e.jsx("div",{className:"bg-white rounded-lg border border-slate-200 p-4 shadow-sm mb-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center pt-2",children:[e.jsx("div",{className:"w-6 h-6 rounded bg-orange-100 flex items-center justify-center text-orange-600 text-xs font-bold border border-orange-200",children:"1"}),e.jsx("div",{className:"w-0.5 flex-1 bg-slate-300 my-1"}),e.jsx("div",{className:"w-6 h-6 rounded bg-green-100 flex items-center justify-center text-green-600 text-xs font-bold border border-green-200",children:s.totalJobs*2})]}),e.jsxs("div",{className:"flex-1 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900 text-sm",children:s.startLocation}),e.jsx("p",{className:"text-xs text-slate-500",children:s.startTime})]}),e.jsxs("div",{className:"py-2 space-y-1",children:[e.jsxs("div",{className:"flex gap-4 text-xs font-medium text-slate-600",children:[e.jsxs("span",{children:[s.totalJobs," jobs"]}),e.jsxs("span",{children:[s.totalMiles," miles"]})]}),e.jsxs("div",{className:"flex gap-4 text-xs font-medium text-slate-600",children:[e.jsx("span",{children:s.totalTime}),e.jsxs("span",{children:[s.capacity,"mÂ³"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900 text-sm",children:s.endLocation}),e.jsx("p",{className:"text-xs text-slate-500",children:s.endTime})]})]})]})}),e.jsxs("div",{className:"h-48 bg-slate-200 rounded-lg border border-slate-300 mb-6 relative overflow-hidden group cursor-pointer",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-300 flex items-center justify-center",children:e.jsx(le,{className:"w-8 h-8 text-slate-400"})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center",children:e.jsx("span",{className:"bg-white/90 px-3 py-1 rounded text-xs font-bold shadow-sm opacity-0 group-hover:opacity-100 transition-opacity",children:"Click to expand map"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-bold text-slate-900 text-sm mb-2",children:"Special requirements"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600 bg-white border border-slate-200 p-2 rounded",children:[e.jsx(ae,{className:"w-3 h-3"}),e.jsx("span",{children:"Multi-stop route"})]})]}),e.jsxs("div",{className:"flex border-b border-slate-200 mb-6",children:[e.jsx("button",{onClick:()=>m("breakdown"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${x==="breakdown"?"border-green-500 text-green-700":"border-transparent text-slate-500"}`,children:"Breakdown"}),e.jsx("button",{onClick:()=>m("schedule"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${x==="schedule"?"border-green-500 text-green-700":"border-transparent text-slate-500"}`,children:"Schedule"})]}),x==="breakdown"&&e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4 space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Total driving time"}),e.jsx("span",{className:"font-medium text-slate-900",children:s.breakdown.drivingTime})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Total loading time"}),e.jsx("span",{className:"font-medium text-slate-900",children:s.breakdown.loadingTime})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Total distance"}),e.jsx("span",{className:"font-medium text-slate-900",children:s.breakdown.distance})]}),e.jsxs("div",{className:"flex justify-between border-t border-slate-100 pt-2",children:[e.jsx("span",{className:"text-slate-500",children:"Max capacity"}),e.jsxs("span",{className:"font-medium text-slate-900",children:[s.capacity,"mÂ³"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Max weight"}),e.jsx("span",{className:"font-medium text-slate-900",children:s.breakdown.maxWeight})]})]})]}),e.jsx("div",{className:"lg:col-span-2 p-6 bg-slate-100/50",children:x==="schedule"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-bold text-slate-900",children:"Schedule"}),e.jsx("button",{className:"text-xs text-blue-600 font-medium bg-white px-2 py-1 rounded border border-slate-200",children:"Expand all"})]}),e.jsx("div",{className:"bg-white border border-slate-200 rounded-lg p-4 text-sm text-slate-600 mb-4",children:"Please make sure you complete each job as you go. If there are additional items or changes, select 'Job Complete With Issue' and tell us."}),s.jobs.map((t,d)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg overflow-hidden shadow-sm",children:[e.jsxs("div",{className:`px-4 py-2 text-xs font-bold flex justify-between items-center ${t.status==="completed"?"bg-green-100 text-green-800":"bg-slate-100 text-slate-600"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${t.status==="completed"?"bg-green-600":"bg-slate-400"}`}),t.status==="completed"?"JOB COMPLETED":"PENDING"]}),t.completedAt&&e.jsx("span",{children:t.completedAt})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"flex flex-col items-center pt-1",children:e.jsx(W,{className:"w-4 h-4 text-slate-400 rotate-90"})}),e.jsxs("div",{className:"flex-1 grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-slate-900 mb-1",children:t.pickup.address}),e.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"})," ",t.time]})]}),e.jsxs("div",{className:"text-right md:text-left",children:[e.jsx("div",{className:"font-bold text-slate-900 mb-1",children:t.customerName}),e.jsx("div",{className:"text-xs text-blue-500 font-medium",children:t.phone}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Ground floor â€¢ No Lift"})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 pt-4 border-t border-slate-100",children:[e.jsxs(w,{variant:"outline",size:"sm",className:"h-8 text-xs text-blue-600 border-blue-200 hover:bg-blue-50",children:[e.jsx(de,{className:"w-3 h-3 mr-1"})," View Job Sheet"]}),t.status!=="completed"&&e.jsxs("div",{className:"ml-auto flex gap-2",children:[e.jsx(w,{variant:"outline",size:"sm",className:"h-8 text-xs text-orange-600 border-orange-200 hover:bg-orange-50",children:"Issues"}),e.jsx(w,{size:"sm",className:"h-8 text-xs bg-green-600 hover:bg-green-700 text-white",children:"Complete Job"})]})]})]})]},d))]})})]})})]})}const N={MAX_JOURNEY_MINUTES:540,WARNING_THRESHOLD_MINUTES:480,TIME_LOADING:20,TIME_UNLOADING:15,TIME_BUFFER:10,SPEED_URBAN:20,SPEED_MOTORWAY:50};function ie(s,n,o,x){if(!s||!n||!o||!x)return 5;const m=3959,c=(o-s)*Math.PI/180,t=(x-n)*Math.PI/180,d=Math.sin(c/2)*Math.sin(c/2)+Math.cos(s*Math.PI/180)*Math.cos(o*Math.PI/180)*Math.sin(t/2)*Math.sin(t/2),a=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d));return m*a}function Le(s){if(!s)return null;try{const n=s.split("-")[0].trim(),[o,x]=n.split(":").map(Number);if(!isNaN(o)&&!isNaN(x))return{hour:o,minute:x}}catch{return null}return null}function Ee(s,n="08:00"){const o=new Date,[x,m]=n.split(":").map(Number),c=new Date(o);c.setHours(x,m,0,0);let t=new Date(c),d=0,a=0,b=0,p=0,h=0;const r=[];for(let u=0;u<s.length;u++){const T=s[u];let k=0,f=0;if(u>0){const v=s[u-1];f=ie(v.address.lat||0,v.address.lng||0,T.address.lat||0,T.address.lng||0);const J=f>10?N.SPEED_MOTORWAY:N.SPEED_URBAN;k=f/J*60,t=new Date(t.getTime()+k*6e4),d+=k,h+=f}let j=0;const D=Le(T.timeWindow);if(D){const v=new Date(t);v.setHours(D.hour,D.minute,0,0),t<v&&(j=(v.getTime()-t.getTime())/6e4)}j>0&&(t=new Date(t.getTime()+j*6e4),b+=j);const S=new Date(t),M=T.type==="collection"?N.TIME_LOADING:N.TIME_UNLOADING;t=new Date(t.getTime()+M*6e4),a+=M,t=new Date(t.getTime()+N.TIME_BUFFER*6e4),p+=N.TIME_BUFFER;const I=new Date(t);r.push({...T,calculatedArrival:S,calculatedDeparture:I,waitingTime:Math.round(j),drivingToNext:0,distanceToNext:0,activityType:T.type==="collection"?"loading":"unloading",activityDuration:M}),u>0&&(r[u-1].drivingToNext=k,r[u-1].distanceToNext=f)}const y=(t.getTime()-c.getTime())/6e4;return{totalDrivingTime:Math.round(d),totalLoadingTime:Math.round(a),totalWaitingTime:Math.round(b),totalBufferTime:Math.round(p),totalDuration:Math.round(y),startTime:c,endTime:t,totalDistance:Math.round(h*10)/10,isOverLimit:y>N.MAX_JOURNEY_MINUTES,utilizationScore:Math.min(100,y/N.MAX_JOURNEY_MINUTES*100),stops:r}}function Ie(s){if(s.length<=2)return s;const n=new Map;s.forEach(d=>{d.jobId&&(n.has(d.jobId)||n.set(d.jobId,{}),d.type==="collection"?n.get(d.jobId).pickup=d:n.get(d.jobId).dropoff=d)});const o=s[0],x=[o],m=new Set;o.type==="collection"&&o.jobId&&m.add(o.jobId);let c=s.slice(1),t=o;for(;c.length>0;){let d=-1,a=1/0;for(let p=0;p<c.length;p++){const h=c[p];if(h.type==="delivery"&&h.jobId&&n.get(h.jobId)?.pickup&&!m.has(h.jobId))continue;const u=ie(t.address.lat||0,t.address.lng||0,h.address.lat||0,h.address.lng||0)+0;u<a&&(a=u,d=p)}d===-1&&(d=0);const b=c[d];b.type==="collection"&&b.jobId&&m.add(b.jobId),x.push(b),t=b,c.splice(d,1)}return x}const Re=({metrics:s,onClose:n,onSplit:o,onOptimize:x})=>{const m=Math.floor(s.totalDuration/60),c=s.totalDuration%60;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"bg-red-50 p-6 border-b border-red-100 flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center shrink-0",children:e.jsx(me,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-red-900",children:"Time Limit Exceeded"}),e.jsx("p",{className:"text-red-700 text-sm",children:"Journey exceeds strict 9-hour limit."})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 rounded-xl border border-slate-200",children:[e.jsx("div",{className:"text-sm font-medium text-slate-500",children:"New Total Time"}),e.jsxs("div",{className:"text-2xl font-bold text-red-600 font-mono",children:[m,"h ",c,"m"]})]}),e.jsx("div",{className:"text-sm text-slate-600 leading-relaxed",children:"You cannot publish a journey that exceeds 9 hours. What would you like to do?"}),e.jsxs("div",{className:"flex flex-col gap-2 pt-2",children:[e.jsxs("button",{onClick:x,className:"w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-bold transition-all",children:[e.jsx(G,{className:"w-4 h-4"}),"Auto-Optimize Route"]}),e.jsxs("button",{onClick:o,className:"w-full flex items-center justify-center gap-2 bg-white border-2 border-slate-200 hover:border-slate-300 text-slate-700 py-3 rounded-xl font-bold transition-all",children:[e.jsx(he,{className:"w-4 h-4"}),"Create New Journey with Last Job"]}),e.jsx("button",{onClick:n,className:"w-full py-2 text-slate-400 hover:text-slate-600 text-sm font-medium",children:"Cancel & Remove Last Job"})]})]})]})})};function Pe({onSave:s}){const{journeyStops:n,removeJobFromJourney:o,clearJourney:x,reorderStops:m,setJourneyStops:c,draftJourneys:t,activeJourneyId:d,activeJourney:a,switchJourney:b,createJourneyDraft:p,deleteJourneyDraft:h}=Me(),[r,y]=g.useState(null),[u,T]=g.useState("08:00"),[k,f]=g.useState(null),[j,D]=g.useState([]),[S,M]=g.useState(""),[I,v]=g.useState(!1);g.useEffect(()=>{if(n.length===0){y(null);return}const l=Ee(n,u);y(l),l.isOverLimit?v(!0):v(!1)},[n,u]);const J=()=>{const l=Ie([...n]);c(l)},U=()=>{if(n.length>0){const l=n[n.length-1];o(l.jobId||l.id),l.jobId&&p(),v(!1)}},$=()=>{if(n.length>0){const l=n[n.length-1];l.jobId&&o(l.jobId),v(!1)}},A=l=>f(l),O=(l,i)=>l.preventDefault(),C=(l,i)=>{l.preventDefault(),k!==null&&(m(k,i),f(null))},B=l=>{j.includes(l)?D(j.filter(i=>i!==l)):D([...j,l])};let L="bg-green-500",R="Good";return r?.totalDuration&&r.totalDuration>N.WARNING_THRESHOLD_MINUTES&&(L="bg-yellow-500",R="Warning"),r?.isOverLimit&&(L="bg-red-500",R="Over Limit"),e.jsxs("div",{className:"space-y-6 relative",children:[I&&r&&e.jsx(Re,{metrics:r,onClose:$,onSplit:U,onOptimize:J}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-2 border-b border-slate-200 mb-6",children:[t.map(l=>e.jsxs("div",{onClick:()=>b(l.id),className:`
              group relative flex items-center gap-2 px-4 py-2 rounded-t-lg border-b-2 cursor-pointer transition-all whitespace-nowrap
              ${d===l.id?"border-blue-600 bg-blue-50/50 text-blue-700 font-bold":"border-transparent hover:bg-slate-50 text-slate-500 hover:text-slate-700"}
            `,children:[e.jsx("span",{className:"text-sm",children:l.name||l.id}),e.jsx("span",{className:"text-xs bg-slate-200 px-1.5 rounded-full text-slate-600",children:l.jobs.length}),t.length>1&&e.jsx("button",{onClick:i=>{i.stopPropagation(),confirm("Delete this journey draft?")&&h(l.id)},className:`ml-2 p-0.5 rounded-full hover:bg-red-100 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity ${d===l.id?"opacity-100":""}`,children:e.jsx(oe,{className:"w-3 h-3"})})]},l.id)),e.jsxs("button",{onClick:p,className:"flex items-center gap-1 px-3 py-2 text-sm font-medium text-slate-500 hover:text-blue-600 transition-colors",children:[e.jsx(re,{className:"w-4 h-4"}),"New Draft"]})]}),n.length===0?e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-300",children:[e.jsx("div",{className:"bg-gradient-to-r from-slate-800 to-slate-900 rounded-2xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm",children:e.jsx(Y,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:a?.name||"Journey Draft"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Ready for planning"})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border-2 border-dashed border-slate-200 p-12 text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(G,{className:"w-10 h-10 text-slate-300"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-2",children:"Empty Journey Canvas"}),e.jsx("p",{className:"text-slate-500 mb-6 max-w-md mx-auto",children:'Select jobs from the "Available Jobs" list to start building this route.'})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"lg:col-span-2 bg-gradient-to-r from-slate-800 to-slate-900 rounded-2xl p-6 text-white shadow-lg flex flex-col justify-between relative overflow-hidden",children:[e.jsx("div",{className:"absolute right-0 top-0 w-64 h-64 bg-white/5 rounded-full -translate-y-1/2 translate-x-1/3 blur-3xl"}),e.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/10",children:e.jsx(Y,{className:"w-6 h-6 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:a?.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("input",{type:"time",value:u,onChange:l=>T(l.target.value),className:"bg-transparent border-b border-slate-600 focus:border-white focus:outline-none w-16 text-center text-white"}),e.jsx("span",{children:"Start"})]})]})]}),e.jsxs("div",{className:`px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider flex items-center gap-2 ${r?.isOverLimit?"bg-red-500/20 text-red-200 border border-red-500/50":r?.totalDuration&&r.totalDuration>N.WARNING_THRESHOLD_MINUTES?"bg-yellow-500/20 text-yellow-200 border border-yellow-500/50":"bg-green-500/20 text-green-200 border border-green-500/50"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${L}`}),R]})]}),e.jsxs("div",{className:"mt-8 relative z-10",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold text-slate-400 mb-1",children:[e.jsxs("span",{children:["Utilization (",Math.round(r?.utilizationScore||0),"%)"]}),e.jsxs("span",{children:[Math.floor((r?.totalDuration||0)/60),"h"," ",(r?.totalDuration||0)%60,"m / 9h Max"]})]}),e.jsxs("div",{className:"w-full h-3 bg-slate-700 rounded-full overflow-hidden flex",children:[e.jsx("div",{style:{width:`${(r?.totalDrivingTime||0)/N.MAX_JOURNEY_MINUTES*100}%`},className:"bg-blue-500 h-full",title:"Driving"}),e.jsx("div",{style:{width:`${(r?.totalLoadingTime||0)/N.MAX_JOURNEY_MINUTES*100}%`},className:"bg-purple-500 h-full",title:"Loading"}),e.jsx("div",{style:{width:`${(r?.totalWaitingTime||0)/N.MAX_JOURNEY_MINUTES*100}%`},className:"bg-orange-500 h-full",title:"Waiting"}),e.jsx("div",{style:{width:`${(r?.totalBufferTime||0)/N.MAX_JOURNEY_MINUTES*100}%`},className:"bg-slate-500 h-full opacity-50",title:"Buffer"})]}),e.jsxs("div",{className:"flex gap-4 mt-2 text-[10px] text-slate-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})," ","Driving"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"})," ","Loading"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500"})," ","Waiting"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-slate-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-blue-600"}),"Time Breakdown"]})}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-slate-50 rounded-lg",children:[e.jsxs("span",{className:"text-slate-500 flex items-center gap-2",children:[e.jsx(F,{className:"w-3 h-3"})," Driving"]}),e.jsxs("span",{className:"font-mono font-bold",children:[Math.floor((r?.totalDrivingTime||0)/60),"h"," ",(r?.totalDrivingTime||0)%60,"m"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-slate-50 rounded-lg",children:[e.jsxs("span",{className:"text-slate-500 flex items-center gap-2",children:[e.jsx(V,{className:"w-3 h-3"})," Loading"]}),e.jsxs("span",{className:"font-mono font-bold",children:[Math.floor((r?.totalLoadingTime||0)/60),"h"," ",(r?.totalLoadingTime||0)%60,"m"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-slate-50 rounded-lg",children:[e.jsxs("span",{className:"text-slate-500 flex items-center gap-2",children:[e.jsx(Z,{className:"w-3 h-3"})," Buffer"]}),e.jsxs("span",{className:"font-mono font-bold text-slate-400",children:[Math.floor((r?.totalBufferTime||0)/60),"h"," ",(r?.totalBufferTime||0)%60,"m"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-slate-200 flex flex-col justify-center gap-3",children:[e.jsxs("button",{onClick:J,className:"w-full flex items-center justify-center gap-2 py-3 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 rounded-xl font-bold transition-all border border-indigo-200",children:[e.jsx(G,{className:"w-4 h-4"}),"Auto-Optimize"]}),e.jsxs("button",{disabled:r?.isOverLimit,onClick:()=>{s&&r&&s({stats:{totalRevenue:500,totalDriverCost:200,grossProfit:300,startTime:r.startTime,endTime:r.endTime,totalDistance:r.totalDistance,totalJourneyTime:r.totalDuration,totalDrivingTime:r.totalDrivingTime,totalLoadingTime:r.totalLoadingTime},timeline:r.stops,driverId:S})},className:`w-full flex items-center justify-center gap-2 py-3 rounded-xl font-bold transition-all shadow-lg ${r?.isOverLimit?"bg-slate-200 text-slate-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white hover:scale-[1.02]"}`,children:[e.jsx(X,{className:"w-4 h-4"}),r?.isOverLimit?"Fix Limit to Create":"Publish Journey"]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6 animate-in slide-in-from-bottom-4 duration-500",children:[e.jsx("div",{className:"lg:col-span-1 space-y-3",children:r?.stops.map((l,i)=>e.jsxs("div",{draggable:!0,onDragStart:()=>A(i),onDragOver:E=>O(E),onDrop:E=>C(E,i),className:`p-3 rounded-xl border-2 transition-all relative group ${k===i?"opacity-50 scale-95 border-dashed border-blue-300":j.includes(l.id)?"bg-blue-50 border-blue-500 shadow-md":"bg-white hover:border-blue-300 border-slate-200"}`,children:[e.jsx("div",{className:"absolute top-3 right-3 z-10",children:e.jsx("input",{type:"checkbox",checked:j.includes(l.id),onChange:()=>B(l.id),className:"w-4 h-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500 cursor-pointer"})}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1 mt-1",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white shadow-sm cursor-move ${l.type==="collection"?"bg-blue-600":"bg-green-600"}`,children:i+1}),i<r.stops.length-1&&e.jsx("div",{className:"w-0.5 h-full bg-slate-200 min-h-[40px]"})]}),e.jsxs("div",{className:"flex-1 pr-6 cursor-pointer",onClick:()=>B(l.id),children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:`text-[10px] font-bold uppercase px-1.5 py-0.5 rounded ${l.type==="collection"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:l.type}),e.jsx("span",{className:"text-xs font-mono text-slate-500 font-bold bg-slate-100 px-1.5 rounded",children:l.calculatedArrival?.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"font-bold text-slate-800 text-sm leading-tight mb-1",children:l.address.address}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-[10px] bg-slate-50 border border-slate-200 px-1.5 py-0.5 rounded text-slate-500",children:[e.jsx(P,{className:"w-3 h-3"}),l.activityDuration,"m work"]}),l.waitingTime>0&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] bg-orange-50 border border-orange-200 px-1.5 py-0.5 rounded text-orange-600",children:[e.jsx(Z,{className:"w-3 h-3"}),l.waitingTime,"m wait"]})]}),l.distanceToNext>0&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400 mt-2 pt-2 border-t border-slate-100",children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsxs("span",{children:[l.distanceToNext.toFixed(1),"mi"]}),e.jsx("span",{className:"text-slate-300",children:"|"}),e.jsxs("span",{children:[Math.round(l.drivingToNext||0),"min drive"]})]})]})]})]},l.id))}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"bg-slate-100 rounded-2xl h-[600px] border-2 border-slate-200 overflow-hidden relative shadow-lg",children:e.jsx(Se,{height:"100%",markers:r?.stops.map((l,i)=>({lat:l.address.lat||51.5,lng:l.address.lng||-.1,label:`${i+1}. ${l.type.toUpperCase()}`,color:l.type==="collection"?"#2563eb":"#16a34a"}))||[],showRoute:!0})})})]})]})]})}function Ae({journeyId:s,journeyNumber:n,totalPrice:o,driverRevenue:x,companyRevenue:m,startLocation:c,endLocation:t,startTime:d,endTime:a,totalStops:b,totalDistance:p,totalDrivingTime:h,totalLoadingTime:r,vehicleType:y,onBack:u,onModifyPrice:T,onSendToDriver:k}){const[f,j]=g.useState("breakdown"),[D,S]=g.useState(!1),[M,I]=g.useState(o),[v,J]=g.useState(""),[U,$]=g.useState(""),A=i=>i.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),O=i=>i.toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),C=i=>{const E=Math.floor(i/60),q=Math.round(i%60);return E>0?`${E}h ${q}m`:`${q}m`},B=()=>{T(),S(!1);const i=document.createElement("div");i.className="fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-xl shadow-2xl z-50",i.innerHTML=`
      <div class="flex items-center gap-3">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        <span class="font-semibold">ðŸ’° Price Updated to Â£${M.toFixed(2)}</span>
      </div>
    `,document.body.appendChild(i),setTimeout(()=>i.remove(),3e3)},L=()=>{k();const i=document.createElement("div");i.className="fixed top-4 right-4 bg-blue-600 text-white px-6 py-3 rounded-xl shadow-2xl z-50",i.innerHTML=`
      <div class="flex items-center gap-3">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        <span class="font-semibold">ðŸšš Journey Sent to Driver Dashboard!</span>
      </div>
    `,document.body.appendChild(i),setTimeout(()=>i.remove(),3e3)},R=()=>{const i=document.createElement("div");i.className="fixed top-4 right-4 bg-purple-600 text-white px-6 py-3 rounded-xl shadow-2xl z-50",i.innerHTML=`
      <div class="flex items-center gap-3">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        <span class="font-semibold">ðŸ“‹ Journey Duplicated Successfully!</span>
      </div>
    `,document.body.appendChild(i),setTimeout(()=>i.remove(),3e3)},l=()=>{const i=document.createElement("div");i.className="fixed top-4 right-4 bg-orange-600 text-white px-6 py-3 rounded-xl shadow-2xl z-50",i.innerHTML=`
      <div class="flex items-center gap-3">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        <span class="font-semibold">ðŸ“„ Exporting Journey PDF...</span>
      </div>
    `,document.body.appendChild(i),setTimeout(()=>i.remove(),3e3)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:u,className:"flex items-center gap-2 px-4 py-2 bg-white border-2 border-slate-300 rounded-xl hover:shadow-lg transition-all text-slate-700 font-semibold",children:[e.jsx(W,{className:"w-5 h-5"}),"Back to Builder"]}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Journey Created Successfully! ðŸŽ‰"}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Journey #",n," is ready to be dispatched"]})]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-slate-600 mb-1",children:"Total Journey Value"}),e.jsxs("div",{className:"text-3xl font-black text-green-600",children:["Â£",o.toFixed(2)]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Driver: Â£",x.toFixed(2)," â€¢ Company: Â£",m.toFixed(2)]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl p-4 border-2 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-blue-900",children:"Next step: Send this Journey to the driver's Dashboard"}),e.jsx("div",{className:"text-sm text-blue-700",children:'Review all details below and click "Send to Driver" when ready.'})]}),e.jsxs("button",{onClick:L,className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl font-semibold hover:shadow-xl transition-all flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Send to Driver"]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border-2 border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-purple-100 mb-1",children:["Journey ID: ",s]}),e.jsxs("h3",{className:"text-2xl font-bold mb-2",children:[b," Stops Journey / Full Day / ",y]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsxs("span",{children:[b," jobs"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsxs("span",{children:[p.toFixed(0)," miles"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:C(h+r)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{children:y})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg backdrop-blur-sm transition-all",children:e.jsx(ue,{className:"w-5 h-5"})}),e.jsx("button",{className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg backdrop-blur-sm transition-all",children:e.jsx(ae,{className:"w-5 h-5"})}),e.jsx("button",{className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg backdrop-blur-sm transition-all",children:e.jsx(pe,{className:"w-5 h-5"})})]})]})}),e.jsx("div",{className:"p-6 border-b-2 border-slate-200",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center border-2 border-blue-300",children:e.jsx("div",{className:"text-blue-900 font-bold text-sm",children:"1"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-slate-900 mb-1",children:c.split(",")[0]}),e.jsxs("div",{className:"text-sm text-slate-600",children:[O(d),", starting at ",A(d)]})]})]})}),e.jsxs("div",{className:"relative flex-shrink-0 px-8",children:[e.jsx("div",{className:"absolute left-0 right-0 top-5 h-0.5 bg-gradient-to-r from-blue-300 via-purple-300 to-green-300"}),e.jsxs("div",{className:"relative bg-white px-4 py-2 rounded-lg border-2 border-purple-200 text-center",children:[e.jsx("div",{className:"text-xs text-purple-700 font-semibold mb-1",children:"Journey Duration"}),e.jsx("div",{className:"font-bold text-purple-900",children:C(h+r)})]})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center border-2 border-green-300",children:e.jsx("div",{className:"text-green-900 font-bold text-sm",children:b})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-slate-900 mb-1",children:t.split(",")[0]}),e.jsxs("div",{className:"text-sm text-slate-600",children:[O(a),", ending at ",A(a)]})]})]})})]})}),e.jsx("div",{className:"border-b-2 border-slate-200",children:e.jsxs("div",{className:"flex gap-1 px-6",children:[e.jsx("button",{onClick:()=>j("breakdown"),className:`px-6 py-3 font-semibold transition-all border-b-4 ${f==="breakdown"?"border-green-600 text-green-900":"border-transparent text-slate-600 hover:text-slate-900"}`,children:"Breakdown"}),e.jsx("button",{onClick:()=>j("schedule"),className:`px-6 py-3 font-semibold transition-all border-b-4 ${f==="schedule"?"border-green-600 text-green-900":"border-transparent text-slate-600 hover:text-slate-900"}`,children:"Schedule"}),e.jsx("button",{onClick:()=>j("notes"),className:`px-6 py-3 font-semibold transition-all border-b-4 ${f==="notes"?"border-green-600 text-green-900":"border-transparent text-slate-600 hover:text-slate-900"}`,children:"Notes & Instructions"})]})}),e.jsxs("div",{className:"p-6",children:[f==="breakdown"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-bold text-lg text-slate-900 mb-4",children:"Journey Breakdown"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[e.jsx(P,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-semibold",children:"Total driving time"})]}),e.jsx("span",{className:"font-bold text-slate-900",children:C(h)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[e.jsx(V,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"font-semibold",children:"Total loading & unloading time"})]}),e.jsx("span",{className:"font-bold text-slate-900",children:C(r)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[e.jsx(F,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"font-semibold",children:"Total distance"})]}),e.jsxs("span",{className:"font-bold text-slate-900",children:[p.toFixed(0)," miles"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[e.jsx(_,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"font-semibold",children:"Vehicle type"})]}),e.jsx("span",{className:"font-bold text-slate-900",children:y})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[e.jsx(le,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"font-semibold",children:"Total stops"})]}),e.jsxs("span",{className:"font-bold text-slate-900",children:[b," stops"]})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[e.jsx(z,{className:"w-4 h-4 text-cyan-600"}),e.jsx("span",{className:"font-semibold",children:"Journey date"})]}),e.jsx("span",{className:"font-bold text-slate-900",children:d.toLocaleDateString("en-GB")})]})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t-2 border-slate-200",children:[e.jsx("h5",{className:"font-bold text-slate-900 mb-4",children:"Revenue Split"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 border-2 border-blue-200",children:[e.jsx("div",{className:"text-sm text-blue-700 font-semibold mb-1",children:"Total Price"}),e.jsxs("div",{className:"text-2xl font-black text-blue-900",children:["Â£",o.toFixed(2)]})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-4 border-2 border-green-200",children:[e.jsx("div",{className:"text-sm text-green-700 font-semibold mb-1",children:"Driver Revenue (70%)"}),e.jsxs("div",{className:"text-2xl font-black text-green-900",children:["Â£",x.toFixed(2)]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl p-4 border-2 border-purple-200",children:[e.jsx("div",{className:"text-sm text-purple-700 font-semibold mb-1",children:"Company Revenue (30%)"}),e.jsxs("div",{className:"text-2xl font-black text-purple-900",children:["Â£",m.toFixed(2)]})]})]})]})]}),f==="schedule"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-bold text-lg text-slate-900 mb-4",children:"Journey Schedule"}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-6 border-2 border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(z,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-blue-900",children:"Full schedule available in Journey Builder"}),e.jsx("div",{className:"text-sm text-blue-700",children:"View detailed timeline with all stops and times"})]})]}),e.jsx("button",{onClick:u,className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-all",children:"View Full Timeline"})]})]}),f==="notes"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold text-slate-900 mb-2",children:"Admin Notes (Internal)"}),e.jsx("textarea",{value:v,onChange:i=>J(i.target.value),placeholder:"Add internal notes about this journey...",className:"w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-blue-500 focus:outline-none resize-none",rows:4})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold text-slate-900 mb-2",children:"Driver Instructions"}),e.jsx("textarea",{value:U,onChange:i=>$(i.target.value),placeholder:"Add special instructions for the driver...",className:"w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-blue-500 focus:outline-none resize-none",rows:4})]}),e.jsxs("button",{className:"px-6 py-3 bg-green-600 text-white rounded-xl font-semibold hover:shadow-lg transition-all flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),"Save Notes"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border-2 border-slate-200 p-6",children:[e.jsx("h4",{className:"font-bold text-lg text-slate-900 mb-4",children:"Journey Actions"}),e.jsxs("div",{className:"grid md:grid-cols-3 lg:grid-cols-4 gap-3",children:[e.jsxs("button",{onClick:()=>S(!D),className:"flex items-center gap-3 px-4 py-4 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-xl font-semibold hover:shadow-xl transition-all",children:[e.jsx(ge,{className:"w-5 h-5"}),e.jsx("span",{children:"Modify Price"})]}),e.jsxs("button",{onClick:L,className:"flex items-center gap-3 px-4 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl font-semibold hover:shadow-xl transition-all",children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("span",{children:"Send to Driver"})]}),e.jsxs("button",{onClick:l,className:"flex items-center gap-3 px-4 py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-semibold hover:shadow-xl transition-all",children:[e.jsx(fe,{className:"w-5 h-5"}),e.jsx("span",{children:"Export PDF"})]}),e.jsxs("button",{onClick:R,className:"flex items-center gap-3 px-4 py-4 bg-gradient-to-r from-cyan-600 to-teal-600 text-white rounded-xl font-semibold hover:shadow-xl transition-all",children:[e.jsx(je,{className:"w-5 h-5"}),e.jsx("span",{children:"Duplicate"})]}),e.jsxs("button",{className:"flex items-center gap-3 px-4 py-4 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-semibold hover:shadow-lg transition-all",children:[e.jsx(X,{className:"w-5 h-5"}),e.jsx("span",{children:"Save Template"})]}),e.jsxs("button",{className:"flex items-center gap-3 px-4 py-4 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-semibold hover:shadow-lg transition-all",children:[e.jsx(Ne,{className:"w-5 h-5"}),e.jsx("span",{children:"Print"})]}),e.jsxs("button",{className:"flex items-center gap-3 px-4 py-4 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-semibold hover:shadow-lg transition-all",children:[e.jsx(ve,{className:"w-5 h-5"}),e.jsx("span",{children:"Email"})]}),e.jsxs("button",{className:"flex items-center gap-3 px-4 py-4 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-semibold hover:shadow-lg transition-all",children:[e.jsx(we,{className:"w-5 h-5"}),e.jsx("span",{children:"Add Note"})]}),e.jsxs("button",{className:"flex items-center gap-3 px-4 py-4 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-semibold hover:shadow-lg transition-all",children:[e.jsx(se,{className:"w-5 h-5"}),e.jsx("span",{children:"Preview"})]}),e.jsxs("button",{className:"flex items-center gap-3 px-4 py-4 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-semibold hover:shadow-lg transition-all",children:[e.jsx(ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Archive"})]}),e.jsxs("button",{className:"flex items-center gap-3 px-4 py-4 bg-white border-2 border-slate-300 text-slate-700 rounded-xl font-semibold hover:shadow-lg transition-all",children:[e.jsx(Te,{className:"w-5 h-5"}),e.jsx("span",{children:"Call Driver"})]}),e.jsxs("button",{className:"flex items-center gap-3 px-4 py-4 bg-white border-2 border-red-300 text-red-700 rounded-xl font-semibold hover:shadow-lg transition-all hover:bg-red-50",children:[e.jsx(ee,{className:"w-5 h-5"}),e.jsx("span",{children:"Cancel Journey"})]})]})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 mb-4",children:"Modify Journey Price"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"New Total Price"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-2xl font-bold text-slate-400",children:"Â£"}),e.jsx("input",{type:"number",value:M,onChange:i=>I(parseFloat(i.target.value)),className:"w-full pl-10 pr-4 py-4 text-2xl font-bold border-2 border-slate-300 rounded-xl focus:border-blue-500 focus:outline-none",step:"0.01"})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 border-2 border-blue-200 mb-6",children:[e.jsx("div",{className:"text-sm text-blue-900 font-semibold mb-2",children:"New Revenue Split:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-blue-700",children:"Driver (70%)"}),e.jsxs("div",{className:"font-bold text-blue-900",children:["Â£",(M*.7).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-blue-700",children:"Company (30%)"}),e.jsxs("div",{className:"font-bold text-blue-900",children:["Â£",(M*.3).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>S(!1),className:"flex-1 px-6 py-3 bg-slate-200 text-slate-700 rounded-xl font-semibold hover:bg-slate-300 transition-all",children:"Cancel"}),e.jsx("button",{onClick:B,className:"flex-1 px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-xl font-semibold hover:shadow-lg transition-all",children:"Save Price"})]})]})})]})}const Oe=[{id:"308562",title:"2 Man Journey / Full Day / 11mÂ³",price:265.11,status:"allocated",date:"Today, starting at 08:40",totalJobs:6,totalMiles:102,totalTime:"7 hr 58 min",capacity:10.72,people:2,startLocation:"Edinburgh, EH9",startTime:"Today, 08:40",endLocation:"Dunfermline, KY12",endTime:"Today, 16:38",driverName:"David Lacatos",vehicleReg:"DC16OCJ",breakdown:{drivingTime:"3 hr 41 min",loadingTime:"4 hr 16 min",distance:"102 miles",maxWeight:"660kg"},jobs:[{status:"completed",completedAt:"9:29 - 30/12/25",pickup:{address:"Edinburgh to Edinburgh"},time:"08:40 - 08:57",customerName:"Kulumba James",phone:"+442038741877"},{status:"pending",pickup:{address:"Edinburgh to Edinburgh"},time:"09:16 - 09:31",customerName:"Sarah Smith",phone:"+442038741888"},{status:"pending",pickup:{address:"Edinburgh to Glasgow"},time:"10:00 - 11:30",customerName:"John Doe",phone:"+442038741899"}]},{id:"308563",title:"1 Man Journey / Half Day / 5mÂ³",price:150,status:"draft",date:"Tomorrow, starting at 09:00",totalJobs:3,totalMiles:45,totalTime:"4 hr 30 min",capacity:5,people:1,startLocation:"London, SW1",startTime:"Tomorrow, 09:00",endLocation:"London, E1",endTime:"Tomorrow, 13:30",breakdown:{drivingTime:"2 hr",loadingTime:"2 hr 30 min",distance:"45 miles",maxWeight:"300kg"},jobs:[]},{id:"308564",title:"3 Man Journey / Full Day / 20mÂ³",price:450.5,status:"published",date:"Jan 2, starting at 07:00",totalJobs:8,totalMiles:150,totalTime:"9 hr 15 min",capacity:20,people:3,startLocation:"Manchester, M1",startTime:"Jan 2, 07:00",endLocation:"Liverpool, L1",endTime:"Jan 2, 16:15",breakdown:{drivingTime:"4 hr",loadingTime:"5 hr 15 min",distance:"150 miles",maxWeight:"1200kg"},jobs:[]}];function Ge(){const[s,n]=g.useState("list"),[o,x]=g.useState(null),[m,c]=g.useState(Oe),[t,d]=g.useState(null);if(s==="detail"&&o){const a=m.find(b=>b.id===o);return a?e.jsx(Ce,{journey:a,onBack:()=>n("list"),onStatusChange:b=>{c(p=>p.map(h=>h.id===o?{...h,status:b}:h))}}):e.jsx("div",{children:"Journey not found"})}return s==="create"?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-4 bg-white border-b border-slate-200 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>n("list"),className:"text-slate-500 hover:text-slate-700",children:"Back to List"}),e.jsx("h2",{className:"font-bold text-slate-900",children:"New Journey Builder"})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsx(Pe,{onSave:a=>{const b=`JNY-${Math.floor(Math.random()*1e4)}`,p={id:b,title:`${a.timeline.length} Stop Journey / Custom`,price:a.stats.totalRevenue,status:"draft",date:"Today",totalJobs:a.timeline.length,totalMiles:a.stats.totalDistance,totalTime:`${Math.floor(a.stats.totalJourneyTime/60)}h ${Math.round(a.stats.totalJourneyTime%60)}m`,capacity:20,people:2,startLocation:a.timeline[0]?.address.address||"Unknown",startTime:a.stats.startTime.toLocaleTimeString(),endLocation:a.timeline[a.timeline.length-1]?.address.address||"Unknown",endTime:a.stats.endTime.toLocaleTimeString(),breakdown:{drivingTime:`${Math.floor(a.stats.totalDrivingTime/60)}h ${Math.round(a.stats.totalDrivingTime%60)}m`,loadingTime:`${Math.floor(a.stats.totalLoadingTime/60)}h ${Math.round(a.stats.totalLoadingTime%60)}m`,distance:`${a.stats.totalDistance.toFixed(1)} miles`,maxWeight:"1000kg"},jobs:a.timeline.map((h,r)=>({status:"pending",pickup:{address:h.address.address},time:h.arrivalTime?.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),customerName:`Customer ${r+1}`,phone:"0700000000"}))};c(h=>[p,...h]),d({...a,id:b}),n("created_success")}})})]}):s==="created_success"&&t?e.jsx("div",{className:"h-full overflow-auto p-6",children:e.jsx(Ae,{journeyId:t.id,journeyNumber:t.id,totalPrice:t.stats.totalRevenue,driverRevenue:t.stats.totalDriverCost,companyRevenue:t.stats.grossProfit,startLocation:t.timeline[0]?.address.address||"Start",endLocation:t.timeline[t.timeline.length-1]?.address.address||"End",startTime:t.stats.startTime,endTime:t.stats.endTime,totalStops:t.timeline.length,totalDistance:t.stats.totalDistance,totalDrivingTime:t.stats.totalDrivingTime,totalLoadingTime:t.stats.totalLoadingTime,vehicleType:"Luton Van",onBack:()=>n("list"),onModifyPrice:()=>console.log("Modify price clicked"),onSendToDriver:()=>{n("list")}})}):e.jsxs("div",{className:"space-y-6 h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900",children:"Journey Management"}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Plan, optimize, and allocate multi-drop routes."})]}),e.jsxs("button",{onClick:()=>n("create"),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-xl transition-all shadow-md font-medium",children:[e.jsx(re,{className:"w-5 h-5"}),"Create New Journey"]})]}),e.jsxs("div",{className:"flex gap-4 shrink-0",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search journeys by ID, driver, or route...",className:"w-full pl-9 pr-4 py-2.5 bg-white border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm"})]}),e.jsxs("button",{className:"px-4 py-2.5 bg-white border border-slate-200 rounded-lg text-slate-700 font-medium flex items-center gap-2 hover:bg-slate-50 shadow-sm text-sm",children:[e.jsx(De,{className:"w-4 h-4"}),"Filter Status"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-3 pb-6",children:m.length===0?e.jsxs("div",{className:"text-center py-20 bg-slate-50 rounded-xl border border-dashed border-slate-300",children:[e.jsx(Y,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-bold text-slate-700",children:"No journeys found"}),e.jsx("p",{className:"text-slate-500",children:"Create a new journey to get started."})]}):m.map(a=>e.jsx(Je,{id:a.id,title:a.title,date:a.date,price:a.price,status:a.status,onClick:()=>{x(a.id),n("detail")}},a.id))})]})}export{Ge as JourneyManagement};
