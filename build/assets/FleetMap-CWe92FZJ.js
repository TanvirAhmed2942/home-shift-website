import{j as e}from"./radix-vendor-BV-zUPZ_.js";import{a}from"./react-vendor-BK8AH302.js";import{m as n}from"./mapbox-gl-BnguMuRq.js";import{M as T}from"./mapboxConfig-B9kHtw8J.js";import{bR as _,aN as C,aQ as J,am as P,bF as D,bJ as j}from"./ui-vendor-DgaPPGCl.js";import"./map-vendor-B8JKxxRh.js";const B={};var A={};const I=[{id:"DRV001",name:"John Smith",status:"available",location:{lat:51.5074,lng:-.1278,address:"Central London"},currentJobs:0,rating:4.8,vehicle:"Large Van",phone:"+44 7700 900123",lastUpdate:new Date},{id:"DRV002",name:"Maria Garcia",status:"available",location:{lat:51.5155,lng:-.1419,address:"Westminster"},currentJobs:0,rating:4.9,vehicle:"Luton Van",phone:"+44 7700 900124",lastUpdate:new Date},{id:"DRV003",name:"Ahmed Hassan",status:"busy",location:{lat:51.4975,lng:-.1357,address:"Southwark"},currentJobs:1,rating:4.7,vehicle:"Medium Van",phone:"+44 7700 900125",lastUpdate:new Date}],R=[{id:"JOB001",customerName:"Alice Brown",pickupAddress:"123 Oxford Street",pickupLocation:{lat:51.5154,lng:-.1419},status:"pending",priority:"urgent",value:450},{id:"JOB002",customerName:"Bob Wilson",pickupAddress:"789 Camden High Street",pickupLocation:{lat:51.5392,lng:-.1426},status:"pending",priority:"high",value:380}];function F(){const g=a.useRef(null),r=a.useRef(null),[u,N]=a.useState(I),[p,O]=a.useState(R),[o,b]=a.useState(null),[i,f]=a.useState(null),[c,y]=a.useState(!0),[d,w]=a.useState(!0),[x,k]=a.useState(!0),[v,M]=a.useState(null),[h,L]=a.useState(""),S=()=>{const s=typeof process<"u"&&A?.NEXT_PUBLIC_MAPBOX_TOKEN||typeof import.meta<"u"&&B?.NEXT_PUBLIC_MAPBOX_TOKEN,t=typeof window<"u"?localStorage.getItem("mapbox_token"):null;return s||t||T},E=()=>{h.trim()&&(localStorage.setItem("mapbox_token",h.trim()),window.location.reload())};a.useEffect(()=>{const s=S();if(!r.current){n.accessToken=s;try{r.current=new n.Map({container:g.current,style:"mapbox://styles/mapbox/light-v11",center:[-.1278,51.5074],zoom:11}),r.current.addControl(new n.NavigationControl,"top-right")}catch(t){console.error("Map init error:",t),M("Failed to initialize map")}return()=>{r.current?.remove(),r.current=null}}},[]),a.useEffect(()=>{r.current},[u,p,c,d]);const m=a.useRef([]);return a.useEffect(()=>{r.current&&(m.current.forEach(s=>s.remove()),m.current=[],c&&u.forEach(s=>{const t=document.createElement("div");t.className="w-8 h-8 bg-blue-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",t.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M10 17h4v5h-4z"/><path d="M20 17h2v5h-2z"/><path d="M15 17h2v5h-2z"/><rect x="2" y="5" width="20" height="12" rx="2"/></svg>',s.status==="busy"&&(t.style.backgroundColor="#eab308"),s.status==="offline"&&(t.style.backgroundColor="#94a3b8");const l=new n.Marker(t).setLngLat([s.location.lng,s.location.lat]).setPopup(new n.Popup().setHTML(`
            <div class="p-2">
              <div class="font-bold">${s.name}</div>
              <div class="text-xs text-gray-500">${s.status}</div>
              <div class="text-xs mt-1">${s.vehicle}</div>
            </div>
          `)).addTo(r.current);t.addEventListener("click",()=>b(s)),m.current.push(l)}),d&&p.forEach(s=>{const t=document.createElement("div");t.className="w-8 h-8 bg-purple-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",t.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>',s.priority==="urgent"&&(t.style.backgroundColor="#ef4444");const l=new n.Marker(t).setLngLat([s.pickupLocation.lng,s.pickupLocation.lat]).setPopup(new n.Popup().setHTML(`
            <div class="p-2">
              <div class="font-bold">${s.id}</div>
              <div class="text-xs text-gray-500">${s.priority}</div>
              <div class="text-xs mt-1">${s.pickupAddress}</div>
            </div>
          `)).addTo(r.current);t.addEventListener("click",()=>f(s)),m.current.push(l)}))},[u,p,c,d]),a.useEffect(()=>{if(!x)return;const s=setInterval(()=>{N(t=>t.map(l=>({...l,location:{...l.location,lat:l.location.lat+(Math.random()-.5)*.001,lng:l.location.lng+(Math.random()-.5)*.001}})))},3e3);return()=>clearInterval(s)},[x]),v?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-8 text-center text-red-600",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Map Error"}),e.jsx("p",{children:v}),e.jsx("p",{className:"text-sm mt-2 text-red-500 mb-4",children:"Please ensure NEXT_PUBLIC_MAPBOX_TOKEN is set in your environment."}),e.jsxs("div",{className:"max-w-md mx-auto bg-white p-4 rounded-lg shadow-sm",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 text-left",children:"Manual Token Entry (Fallback)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:h,onChange:s=>L(s.target.value),placeholder:"pk.eyJ1...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm"}),e.jsxs("button",{onClick:E,className:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-bold hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"})," Save"]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 text-left",children:"This will save to your browser's local storage."})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"font-bold text-slate-800",children:"Live Fleet Map"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>y(!c),className:`px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-2 ${c?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"}`,children:[e.jsx(J,{className:"w-4 h-4"})," Drivers"]}),e.jsxs("button",{onClick:()=>w(!d),className:`px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-2 ${d?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-600"}`,children:[e.jsx(P,{className:"w-4 h-4"})," Jobs"]}),e.jsxs("button",{onClick:()=>k(!x),className:`px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-2 ${x?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:[e.jsx(D,{className:`w-4 h-4 ${x?"animate-spin":""}`})," Live"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-3 h-[600px] bg-slate-100 rounded-xl overflow-hidden relative shadow-lg border border-slate-200",children:[e.jsx("div",{ref:g,className:"w-full h-full"}),e.jsxs("div",{className:"absolute top-4 left-4 bg-white/90 backdrop-blur p-3 rounded-lg shadow-md text-xs space-y-2",children:[e.jsx("div",{className:"font-bold mb-1",children:"Legend"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"})," Available Driver"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"})," Busy Driver"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded-full"})," Job"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"})," Urgent Job"]})]})]}),e.jsx("div",{className:"space-y-4 h-[600px] overflow-y-auto pr-1",children:o?e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-slate-200",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"font-bold",children:"Driver Info"}),e.jsx("button",{onClick:()=>b(null),children:e.jsx(j,{className:"w-5 h-5 text-gray-400"})})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"Name:"})," ",e.jsx("strong",{children:o.name})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"Status:"})," ",e.jsx("span",{className:"uppercase font-bold text-xs px-2 py-0.5 bg-gray-100 rounded",children:o.status})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"Vehicle:"})," ",o.vehicle]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"Phone:"})," ",o.phone]}),e.jsx("hr",{className:"my-2"}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Last updated: ",o.lastUpdate.toLocaleTimeString()]})]})]}):i?e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-slate-200",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"font-bold",children:"Job Info"}),e.jsx("button",{onClick:()=>f(null),children:e.jsx(j,{className:"w-5 h-5 text-gray-400"})})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"ID:"})," ",e.jsx("strong",{children:i.id})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"Priority:"})," ",e.jsx("span",{className:"uppercase font-bold text-xs px-2 py-0.5 bg-red-100 text-red-700 rounded",children:i.priority})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"Pickup:"})," ",i.pickupAddress]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"Customer:"})," ",i.customerName]})]})]}):e.jsx("div",{className:"bg-slate-50 p-6 rounded-xl text-center text-gray-500 text-sm border border-dashed border-slate-300 h-full flex items-center justify-center",children:e.jsx("p",{children:"Select a marker on the map to view details"})})})]})]})}export{F as FleetMap};
