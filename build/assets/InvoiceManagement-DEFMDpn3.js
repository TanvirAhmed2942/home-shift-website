import{j as e}from"./radix-vendor-BV-zUPZ_.js";import{a as n}from"./react-vendor-BK8AH302.js";import{C as d,a as o,b as x,c as m,d as L,B as T}from"./badge-ouIqNJOe.js";import{h as f,k as R,B as a,l as B,s as $,o as H}from"./index-CcmsAmAk.js";import{I as O}from"./input-BxsHJbd6.js";import{aS as V,ax as v,aC as w,bG as y,aR as j,ak as q,ao as C,b4 as G,bI as k,b0 as S,bg as J}from"./ui-vendor-DgaPPGCl.js";function Z(){const[t,I]=n.useState(f()),[c,D]=n.useState(""),[l,h]=n.useState("all"),[u,P]=n.useState(null),[F,g]=n.useState(!1),r=n.useMemo(()=>!t||!Array.isArray(t)?{total:0,count:0,paid:0,paidCount:0,pending:0,pendingCount:0,overdue:0,overdueCount:0}:R(t),[t]),p=n.useMemo(()=>!t||!Array.isArray(t)?[]:t.filter(s=>{if(!s)return!1;const i=(s.invoiceNumber||"").toLowerCase().includes(c.toLowerCase())||(s.customer?.name||"").toLowerCase().includes(c.toLowerCase())||(s.jobReference||"").toLowerCase().includes(c.toLowerCase()),E=l==="all"||s.status===l;return i&&E}),[t,c,l]),N=async s=>{try{await B(s)}catch(i){console.error("Error downloading PDF:",i),alert("Error downloading PDF. Please try again.")}},b=async s=>{try{await $(s),alert(`Invoice sent to ${s.customer.email}`)}catch(i){console.error("Error sending email:",i),alert("Error sending email. Please try again.")}},M=s=>{H(s.id),I(f()),alert(`Invoice ${s.invoiceNumber} marked as paid!`)},A=s=>{switch(s){case"paid":return"bg-green-100 text-green-800 border-green-200";case"sent":return"bg-blue-100 text-blue-800 border-blue-200";case"overdue":return"bg-red-100 text-red-800 border-red-200";case"draft":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},z=s=>{switch(s){case"paid":return e.jsx(v,{className:"w-4 h-4"});case"sent":return e.jsx(w,{className:"w-4 h-4"});case"overdue":return e.jsx(y,{className:"w-4 h-4"});default:return e.jsx(j,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(d,{className:"bg-gradient-to-br from-blue-500/10 via-purple-500/10 to-pink-500/10 border-white/20 backdrop-blur-sm",children:[e.jsx(o,{className:"pb-3",children:e.jsxs(x,{className:"text-sm flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4 text-purple-600"}),"Total Revenue"]})}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-2xl",children:["£",(r.total||0).toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[r.count||0," invoices"]})]})]}),e.jsxs(d,{className:"bg-gradient-to-br from-green-500/10 via-emerald-500/10 to-teal-500/10 border-white/20 backdrop-blur-sm",children:[e.jsx(o,{className:"pb-3",children:e.jsxs(x,{className:"text-sm flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4 text-green-600"}),"Paid"]})}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-2xl",children:["£",(r.paid||0).toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[r.paidCount||0," invoices"]})]})]}),e.jsxs(d,{className:"bg-gradient-to-br from-yellow-500/10 via-orange-500/10 to-amber-500/10 border-white/20 backdrop-blur-sm",children:[e.jsx(o,{className:"pb-3",children:e.jsxs(x,{className:"text-sm flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-yellow-600"}),"Pending"]})}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-2xl",children:["£",(r.pending||0).toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[r.pendingCount||0," invoices"]})]})]}),e.jsxs(d,{className:"bg-gradient-to-br from-red-500/10 via-rose-500/10 to-pink-500/10 border-white/20 backdrop-blur-sm",children:[e.jsx(o,{className:"pb-3",children:e.jsxs(x,{className:"text-sm flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4 text-red-600"}),"Overdue"]})}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-2xl",children:["£",(r.overdue||0).toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[r.overdueCount||0," invoices"]})]})]})]}),e.jsxs(d,{className:"bg-white/50 backdrop-blur-sm border-white/20",children:[e.jsxs(o,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5"}),"Invoice Management"]}),e.jsx(L,{children:"View, manage, and send invoices to customers"})]}),e.jsxs(m,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(O,{placeholder:"Search by invoice number, customer name, or job reference...",value:c,onChange:s=>D(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(a,{variant:l==="all"?"default":"outline",onClick:()=>h("all"),size:"sm",children:"All"}),e.jsx(a,{variant:l==="paid"?"default":"outline",onClick:()=>h("paid"),size:"sm",children:"Paid"}),e.jsx(a,{variant:l==="sent"?"default":"outline",onClick:()=>h("sent"),size:"sm",children:"Pending"}),e.jsx(a,{variant:l==="overdue"?"default":"outline",onClick:()=>h("overdue"),size:"sm",children:"Overdue"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left p-3 text-sm",children:"Invoice #"}),e.jsx("th",{className:"text-left p-3 text-sm",children:"Customer"}),e.jsx("th",{className:"text-left p-3 text-sm",children:"Job Ref"}),e.jsx("th",{className:"text-left p-3 text-sm",children:"Date"}),e.jsx("th",{className:"text-left p-3 text-sm",children:"Due Date"}),e.jsx("th",{className:"text-left p-3 text-sm",children:"Amount"}),e.jsx("th",{className:"text-left p-3 text-sm",children:"Status"}),e.jsx("th",{className:"text-right p-3 text-sm",children:"Actions"})]})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center p-8 text-gray-500",children:"No invoices found"})}):p.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50/50",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"font-mono text-sm",children:s.invoiceNumber})]})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.customer.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.customer.email})]})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"font-mono text-sm text-gray-600",children:s.jobReference})}),e.jsx("td",{className:"p-3 text-sm",children:C(new Date(s.issueDate),"dd MMM yyyy")}),e.jsx("td",{className:"p-3 text-sm",children:C(new Date(s.dueDate),"dd MMM yyyy")}),e.jsxs("td",{className:"p-3",children:[e.jsxs("div",{className:"font-medium",children:["£",(s.total||0).toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["(VAT: £",(s.vatAmount||0).toFixed(2),")"]})]}),e.jsx("td",{className:"p-3",children:e.jsxs(T,{variant:"outline",className:`${A(s.status)} flex items-center gap-1 w-fit`,children:[z(s.status),s.status]})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>{P(s),g(!0)},title:"Preview",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>N(s),title:"Download PDF",children:e.jsx(k,{className:"w-4 h-4"})}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>b(s),title:"Send Email",children:e.jsx(S,{className:"w-4 h-4"})}),s.status!=="paid"&&e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>M(s),title:"Mark as Paid",className:"text-green-600 hover:text-green-700",children:e.jsx(J,{className:"w-4 h-4"})})]})})]},s.id))})]})})]})]}),F&&u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Invoice Preview"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>N(u),children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Download"]}),e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>b(u),children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Send Email"]}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>g(!1),children:"Close"})]})]}),e.jsx("div",{className:"p-6",children:e.jsx("iframe",{srcDoc:require("../../utils/invoiceGenerator").generateInvoiceHTML(u),className:"w-full h-[70vh] border rounded-lg",title:"Invoice Preview"})})]})})]})}export{Z as InvoiceManagement};
