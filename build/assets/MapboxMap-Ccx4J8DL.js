import{c as T,r as s,j as n}from"./index-5UJQZh1O.js";import{m as a}from"./mapbox-gl-BOtOi1eW.js";import{f as L}from"./configService-Ux2mtHae.js";import{M as C}from"./mapboxConfig-B9kHtw8J.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],K=T("arrow-left",P);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],z=T("arrow-right",S),B={};var I={};function F({markers:m=[],pickup:i,delivery:d,showRoute:u=!0,interactive:M=!0,height:b="300px",className:h=""}){const p=s.useRef(null),r=s.useRef(null),[y,_]=s.useState(null),[f,k]=s.useState(""),[w,j]=s.useState(null),N=async()=>{const t=typeof process<"u"&&I?.NEXT_PUBLIC_MAPBOX_TOKEN||typeof import.meta<"u"&&B?.NEXT_PUBLIC_MAPBOX_TOKEN;if(t)return t;const e=typeof window<"u"?localStorage.getItem("mapbox_token"):null;if(e)return e;const l=await L();return l?.mapboxToken?(localStorage.setItem("mapbox_token",l.mapboxToken),l.mapboxToken):C},E=()=>{f.trim()&&(localStorage.setItem("mapbox_token",f.trim()),window.location.reload())},o=[...m];i&&o.push({lat:i.lat,lng:i.lng,label:"Pickup",color:"#3b82f6"}),d&&o.push({lat:d.lat,lng:d.lng,label:"Delivery",color:"#ef4444"}),s.useEffect(()=>((async()=>{const e=await N();if(!e){_("Missing NEXT_PUBLIC_MAPBOX_TOKEN");return}if(j(e),r.current||!p.current)return;a.accessToken=e;const l=o.length>0?[o[0].lng,o[0].lat]:[-.1278,51.5074];try{r.current=new a.Map({container:p.current,style:"mapbox://styles/mapbox/light-v11",center:l,zoom:11,interactive:M}),r.current.addControl(new a.NavigationControl,"top-right"),r.current.on("load",()=>{u&&o.length>=2&&v(o,e)})}catch(x){console.error("Mapbox init error:",x),_("Failed to load map")}})(),()=>{r.current&&(r.current.remove(),r.current=null)}),[]),s.useEffect(()=>{if(r.current){if(o.forEach(t=>{new a.Marker({color:t.color||"#3b82f6"}).setLngLat([t.lng,t.lat]).setPopup(t.label?new a.Popup().setHTML(`<b>${t.label}</b>`):void 0).addTo(r.current)}),o.length>=1){const t=new a.LngLatBounds;o.forEach(e=>t.extend([e.lng,e.lat])),r.current.fitBounds(t,{padding:50})}u&&o.length>=2&&v(o)}},[m,i,d,u]);const v=async(t,e)=>{if(!r.current||(!e&&w&&(e=w),!e&&typeof a<"u"&&a.accessToken&&(e=a.accessToken),!e))return;const x=`https://api.mapbox.com/directions/v5/mapbox/driving/${t.map(c=>`${c.lng},${c.lat}`).join(";")}?geometries=geojson&access_token=${e}`;try{const g=(await(await fetch(x)).json()).routes?.[0]?.geometry;g&&(r.current.getSource("route")?r.current.getSource("route").setData({type:"Feature",properties:{},geometry:g}):r.current.addLayer({id:"route",type:"line",source:{type:"geojson",data:{type:"Feature",properties:{},geometry:g}},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3b82f6","line-width":5,"line-opacity":.75}}))}catch(c){console.error("Error fetching route:",c)}};return y?n.jsxs("div",{style:{height:b,width:"100%"},className:`bg-gray-100 flex flex-col items-center justify-center rounded-xl border border-gray-300 ${h} p-4`,children:[n.jsxs("div",{className:"text-center mb-4",children:[n.jsx("p",{className:"font-bold text-gray-500",children:"Map Unavailable"}),n.jsx("p",{className:"text-xs text-gray-400",children:y})]}),n.jsxs("div",{className:"w-full max-w-xs bg-white p-3 rounded shadow-sm border border-gray-200",children:[n.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Enter Token Manually:"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"text",value:f,onChange:t=>k(t.target.value),placeholder:"pk.eyJ1...",className:"flex-1 px-2 py-1.5 border border-gray-300 rounded text-xs w-full"}),n.jsx("button",{onClick:E,className:"px-3 py-1.5 bg-blue-600 text-white rounded text-xs font-bold hover:bg-blue-700 whitespace-nowrap",children:"Save"})]})]})]}):n.jsx("div",{className:`relative overflow-hidden rounded-xl ${h}`,children:n.jsx("div",{ref:p,style:{height:b,width:"100%"}})})}export{z as A,F as M,K as a};
