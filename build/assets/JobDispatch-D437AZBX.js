import{j as e}from"./radix-vendor-BV-zUPZ_.js";import{a as n}from"./react-vendor-BK8AH302.js";import{j as a}from"./index-BcnowT96.js";import{ak as O,au as V,av as b,at as I,by as u,bK as R,bL as T,aA as B,ax as $,aW as v,am as N,ay as f,bq as E}from"./ui-vendor-qxZeYYxY.js";const j=[{id:"DRV001",name:"John Driver",phone:"+44 7700 900789",rating:4.9,vehicle:"LWB Van",available:!0},{id:"DRV002",name:"Mike Wilson",phone:"+44 7700 900790",rating:4.8,vehicle:"Luton Van",available:!0},{id:"DRV003",name:"Sarah Parker",phone:"+44 7700 900791",rating:4.7,vehicle:"Small Van",available:!1},{id:"DRV004",name:"Tom Anderson",phone:"+44 7700 900792",rating:4.9,vehicle:"LWB Van",available:!0},{id:"DRV005",name:"Emma Davis",phone:"+44 7700 900793",rating:4.6,vehicle:"Luton Van",available:!0}];function H(){const[c,y]=n.useState([]),[o,m]=n.useState(null),[x,h]=n.useState(""),[g,w]=n.useState("pending"),[r,D]=n.useState("");n.useEffect(()=>{i(),a.on("job_created",i),a.on("job_status_changed",i),a.on("job_assigned",i)},[]);const i=()=>{const s=a.getAllJobs();y(s)},p=c.filter(s=>{const t=g==="all"||s.status===g,l=r===""||s.title.toLowerCase().includes(r.toLowerCase())||s.pickup.address.toLowerCase().includes(r.toLowerCase())||s.delivery.address.toLowerCase().includes(r.toLowerCase())||s.customerName.toLowerCase().includes(r.toLowerCase());return t&&l}),k=()=>{if(!o||!x){alert("Please select both a job and a driver");return}const s=j.find(l=>l.id===x);if(!s)return;a.assignJobToDriver(o.id,s.id,s.name,s.phone)?(alert(`âœ… Job assigned to ${s.name}!

The driver will be notified and can accept the job.`),m(null),h(""),i()):alert("âŒ Failed to assign job. Please try again.")},C=s=>{a.updateJobStatus(s.id,"available")&&(alert(`âœ… Job published to driver marketplace!

Drivers can now view and accept this job.`),i())},S=(s,t)=>{a.toggleInterestOnlyMode(s,t)?(alert(t?`âœ… Interest Only mode enabled!

Drivers can only express interest. You must assign the job manually.`:`âœ… Interest Only mode disabled!

Drivers can now accept the job directly.`),i()):alert("âŒ Failed to toggle Interest Only mode.")},P=(s,t)=>{const l=a.getJob(s);if(!l)return;const d=l.interestedDrivers?.find(M=>M.id===t);if(!d)return;a.assignJobToDriver(s,d.id,d.name,d.phone)?(alert(`âœ… Job assigned to ${d.name}!

The driver will be notified.`),i()):alert("âŒ Failed to assign job.")},A=s=>{const t={pending:"bg-yellow-100 text-yellow-700 border-yellow-300",assigned:"bg-blue-100 text-blue-700 border-blue-300",available:"bg-purple-100 text-purple-700 border-purple-300",accepted:"bg-green-100 text-green-700 border-green-300","in-progress":"bg-indigo-100 text-indigo-700 border-indigo-300",completed:"bg-slate-100 text-slate-700 border-slate-300",cancelled:"bg-red-100 text-red-700 border-red-300",disputed:"bg-orange-100 text-orange-700 border-orange-300"};return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold border ${t[s]}`,children:s.toUpperCase()})},L=c.filter(s=>s.status==="pending").length,J=c.filter(s=>s.status==="assigned").length,F=c.filter(s=>s.status==="in-progress").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900",children:"Job Dispatch"}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Assign jobs to drivers and manage job status"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"px-4 py-2 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("div",{className:"text-xs text-yellow-700",children:"Pending"}),e.jsx("div",{className:"text-xl font-bold text-yellow-900",children:L})]}),e.jsxs("div",{className:"px-4 py-2 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("div",{className:"text-xs text-blue-700",children:"Assigned"}),e.jsx("div",{className:"text-xl font-bold text-blue-900",children:J})]}),e.jsxs("div",{className:"px-4 py-2 bg-indigo-50 border border-indigo-200 rounded-lg",children:[e.jsx("div",{className:"text-xs text-indigo-700",children:"In Progress"}),e.jsx("div",{className:"text-xl font-bold text-indigo-900",children:F})]})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-slate-200 p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search by customer, location, job title...",value:r,onChange:s=>D(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-200 outline-none"})]}),e.jsxs("select",{value:g,onChange:s=>w(s.target.value),className:"px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-200 outline-none",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"available",children:"Available (Marketplace)"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]})]})}),e.jsxs("div",{className:"grid gap-4",children:[p.map(s=>e.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-slate-200 hover:border-blue-300 transition-all overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-900",children:s.title}),A(s.status)]}),e.jsx("p",{className:"text-sm text-blue-600 font-semibold",children:s.service}),e.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:["Job #",s.id]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Customer Price"}),e.jsxs("div",{className:"text-2xl font-bold text-slate-900",children:["Â£",s.customerPrice.toFixed(2)]}),e.jsxs("div",{className:"text-xs text-green-600 font-semibold mt-1",children:["Driver: Â£",s.driverPrice.toFixed(2)," | Margin: Â£",s.platformFee.toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(V,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{className:"font-semibold text-slate-900",children:["Customer: ",s.customerName]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm text-slate-700",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3 text-slate-500"}),s.customerPhone]})})]}),s.driverId&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 mb-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(I,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"font-semibold text-slate-900",children:["Driver: ",s.driverName]})]}),e.jsxs("div",{className:"text-sm text-slate-700 flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3 text-slate-500"}),s.driverPhone]})]}),e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsx("div",{className:"w-0.5 h-8 bg-slate-300"}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Pickup"}),e.jsx("div",{className:"font-semibold text-slate-900",children:s.pickup.address}),e.jsx("div",{className:"text-xs text-slate-600",children:s.pickup.postcode})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Delivery"}),e.jsx("div",{className:"font-semibold text-slate-900",children:s.delivery.address}),e.jsx("div",{className:"text-xs text-slate-600",children:s.delivery.postcode})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Date & Time"}),e.jsx("div",{className:"font-semibold text-slate-900 text-sm",children:s.date}),e.jsx("div",{className:"text-xs text-slate-600",children:s.time})]}),e.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Distance"}),e.jsxs("div",{className:"font-semibold text-slate-900 text-sm",children:[s.distance," mi"]}),e.jsx("div",{className:"text-xs text-slate-600",children:s.duration})]}),e.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Volume"}),e.jsxs("div",{className:"font-semibold text-slate-900 text-sm",children:[s.totalVolume," mÂ³"]}),e.jsx("div",{className:"text-xs text-slate-600",children:s.vehicle})]}),e.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Crew"}),e.jsxs("div",{className:"font-semibold text-slate-900 text-sm",children:[s.crew," people"]}),e.jsx("div",{className:"text-xs text-slate-600",children:"Required"})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 mb-4",children:[e.jsxs("div",{className:"text-xs text-slate-500 mb-2",children:["Items (",s.items.length,")"]}),e.jsx("div",{className:"text-sm text-slate-700",children:s.description})]}),s.status==="completed"&&s.completionMethod&&e.jsx("div",{className:`rounded-lg p-4 mb-4 border-2 ${s.completionMethod==="mobile"?"bg-gradient-to-r from-green-50 to-emerald-50 border-green-300":"bg-gradient-to-r from-red-50 to-orange-50 border-red-300"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`mt-0.5 ${s.completionMethod==="mobile"?"text-green-600":"text-red-600"}`,children:s.completionMethod==="mobile"?"âœ…":"âš ï¸"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-bold text-slate-900 mb-1 flex items-center gap-2",children:[e.jsx("span",{children:"Completion Method:"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${s.completionMethod==="mobile"?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:s.completionMethod.toUpperCase()})]}),s.completionMethod==="mobile"?e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("p",{className:"text-green-700 font-semibold",children:"âœ… Job completed via MOBILE APP (GPS Verified)"}),s.completionLocation&&s.completionLocation.lat&&s.completionLocation.lng&&e.jsxs("p",{className:"text-slate-600 text-xs",children:["ðŸ“ GPS Location: ",s.completionLocation.lat.toFixed(6),", ",s.completionLocation.lng.toFixed(6)]}),e.jsx("p",{className:"text-slate-500 text-xs",children:"Completed at delivery location with GPS proof"})]}):e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("p",{className:"text-red-700 font-semibold",children:"âš ï¸ Job marked complete via WEB DASHBOARD"}),e.jsx("p",{className:"text-orange-600 text-xs font-semibold",children:"No GPS verification available - manual review recommended"}),e.jsx("p",{className:"text-slate-500 text-xs",children:"Driver acknowledged account termination risk"})]}),s.completedAt&&e.jsxs("p",{className:"text-slate-500 text-xs mt-2",children:["Completed: ",new Date(s.completedAt).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})}),(s.status==="pending"||s.status==="available")&&e.jsxs("div",{className:"bg-gradient-to-r from-pink-50 to-rose-50 rounded-lg p-4 mb-4 border-2 border-pink-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5 text-pink-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900",children:"Interest Only Mode"}),e.jsx("p",{className:"text-xs text-slate-600",children:s.interestOnly?"Drivers can only express interest - you must assign manually":"Drivers can accept the job directly"})]})]}),e.jsx("button",{onClick:t=>{t.stopPropagation(),S(s.id,!s.interestOnly)},className:`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all ${s.interestOnly?"bg-pink-600 hover:bg-pink-700 text-white":"bg-slate-200 hover:bg-slate-300 text-slate-700"}`,children:s.interestOnly?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:"ON"})]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-5 h-5"}),e.jsx("span",{children:"OFF"})]})})]}),s.interestOnly&&s.interestedDrivers&&s.interestedDrivers.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-pink-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("h5",{className:"font-bold text-slate-900 flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-pink-600"}),"Interested Drivers (",s.interestedDrivers.length,")"]})}),e.jsx("div",{className:"space-y-2",children:s.interestedDrivers.map(t=>e.jsx("div",{className:"bg-white rounded-lg p-3 border border-pink-200 hover:border-pink-400 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-pink-500 to-rose-600 flex items-center justify-center text-white font-bold text-sm",children:t.name.split(" ").map(l=>l[0]).join("")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-slate-900",children:t.name}),e.jsx("div",{className:"text-xs text-slate-600",children:t.phone}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Interested: ",new Date(t.timestamp).toLocaleString("en-GB",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mr-3",children:[e.jsxs("div",{className:"text-center bg-yellow-50 rounded-lg px-3 py-2",children:[e.jsx("div",{className:"text-xs text-yellow-700",children:"Rating"}),e.jsxs("div",{className:"font-bold text-yellow-800 flex items-center justify-center gap-1",children:[e.jsx($,{className:"w-3 h-3 fill-yellow-500 text-yellow-500"}),t.rating]})]}),e.jsxs("div",{className:"text-center bg-blue-50 rounded-lg px-3 py-2",children:[e.jsx("div",{className:"text-xs text-blue-700",children:"Vehicle"}),e.jsx("div",{className:"font-bold text-blue-800 text-xs",children:t.vehicle})]}),e.jsxs("div",{className:"text-center bg-purple-50 rounded-lg px-3 py-2",children:[e.jsx("div",{className:"text-xs text-purple-700",children:"Capacity"}),e.jsxs("div",{className:"font-bold text-purple-800",children:[t.capacity," mÂ³"]})]}),e.jsxs("div",{className:"text-center bg-green-50 rounded-lg px-3 py-2",children:[e.jsx("div",{className:"text-xs text-green-700",children:"Distance"}),e.jsxs("div",{className:"font-bold text-green-800",children:[t.distanceFromJob.toFixed(1)," mi"]})]})]}),e.jsxs("button",{onClick:l=>{l.stopPropagation(),P(s.id,t.id)},className:"px-4 py-2 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-lg font-semibold transition-all shadow-md flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4"}),"Assign"]})]})},t.id))})]}),s.interestOnly&&(!s.interestedDrivers||s.interestedDrivers.length===0)&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-pink-200 text-center py-4",children:[e.jsx(u,{className:"w-8 h-8 text-pink-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-600",children:"No drivers have expressed interest yet"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Wait for drivers to show interest or assign manually"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-200",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>m(s),className:"flex-1 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg font-semibold transition-all shadow-md flex items-center justify-center gap-2",children:[e.jsx(v,{className:"w-4 h-4"}),"Assign to Driver"]}),e.jsxs("button",{onClick:()=>C(s),className:"flex-1 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white rounded-lg font-semibold transition-all shadow-md flex items-center justify-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),"Publish to Marketplace"]})]}),s.status==="assigned"&&e.jsx("div",{className:"flex-1 py-2 bg-blue-50 border-2 border-blue-300 text-blue-700 rounded-lg font-semibold text-center",children:"Waiting for driver to accept..."}),s.status==="available"&&e.jsx("div",{className:"flex-1 py-2 bg-purple-50 border-2 border-purple-300 text-purple-700 rounded-lg font-semibold text-center",children:"Published in driver marketplace"}),s.status==="accepted"&&e.jsxs("div",{className:"flex-1 py-2 bg-green-50 border-2 border-green-300 text-green-700 rounded-lg font-semibold flex items-center justify-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"}),"Accepted by driver"]}),s.status==="in-progress"&&e.jsxs("div",{className:"flex-1 py-2 bg-indigo-50 border-2 border-indigo-300 text-indigo-700 rounded-lg font-semibold flex items-center justify-center gap-2",children:[e.jsx(E,{className:"w-4 h-4"}),"Job in progress"]}),s.status==="completed"&&e.jsxs("div",{className:"flex-1 py-2 bg-slate-50 border-2 border-slate-300 text-slate-700 rounded-lg font-semibold flex items-center justify-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"}),"Completed"]})]})]})},s.id)),p.length===0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-slate-200 p-12 text-center",children:[e.jsx(N,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-slate-700 mb-2",children:"No jobs found"}),e.jsx("p",{className:"text-slate-500",children:"Try adjusting your filters"})]})]}),o&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-slate-200",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"Assign Driver to Job"}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:o.title})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-3",children:"Select Driver"}),e.jsx("div",{className:"space-y-3",children:j.map(s=>e.jsx("button",{onClick:()=>h(s.id),disabled:!s.available,className:`w-full p-4 rounded-lg border-2 transition-all text-left ${x===s.id?"border-blue-500 bg-blue-50":s.available?"border-slate-200 hover:border-blue-300":"border-slate-100 bg-slate-50 opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white font-bold",children:s.name.split(" ").map(t=>t[0]).join("")}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-slate-900",children:s.name}),e.jsx("div",{className:"text-sm text-slate-600",children:s.phone})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-slate-600",children:s.vehicle}),e.jsxs("div",{className:"text-sm font-semibold text-yellow-600",children:["â˜… ",s.rating]}),e.jsx("div",{className:`text-xs font-semibold mt-1 ${s.available?"text-green-600":"text-red-600"}`,children:s.available?"Available":"Busy"})]})]})},s.id))})]}),e.jsxs("div",{className:"p-6 border-t border-slate-200 flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>{m(null),h("")},className:"px-6 py-2 border border-slate-300 rounded-lg hover:bg-slate-50 transition-all",children:"Cancel"}),e.jsx("button",{onClick:k,disabled:!x,className:"px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Assign Driver"})]})]})})]})}export{H as JobDispatch};
