import{j as n}from"./radix-vendor-BV-zUPZ_.js";import{a as s}from"./react-vendor-BK8AH302.js";import{m as a}from"./mapbox-gl-BnguMuRq.js";import{f as E}from"./configService-becgr1wi.js";import{M as C}from"./mapboxConfig-B9kHtw8J.js";const L={};var P={};function U({markers:g=[],pickup:i,delivery:u,showRoute:d=!0,interactive:T=!0,height:b="300px",className:y=""}){const p=s.useRef(null),r=s.useRef(null),[h,_]=s.useState(null),[f,j]=s.useState(""),[v,M]=s.useState(null),N=async()=>{const t=typeof process<"u"&&P?.NEXT_PUBLIC_MAPBOX_TOKEN||typeof import.meta<"u"&&L?.NEXT_PUBLIC_MAPBOX_TOKEN;if(t)return t;const e=typeof window<"u"?localStorage.getItem("mapbox_token"):null;if(e)return e;const l=await E();return l?.mapboxToken?(localStorage.setItem("mapbox_token",l.mapboxToken),l.mapboxToken):C},k=()=>{f.trim()&&(localStorage.setItem("mapbox_token",f.trim()),window.location.reload())},o=[...g];i&&o.push({lat:i.lat,lng:i.lng,label:"Pickup",color:"#3b82f6"}),u&&o.push({lat:u.lat,lng:u.lng,label:"Delivery",color:"#ef4444"}),s.useEffect(()=>((async()=>{const e=await N();if(!e){_("Missing NEXT_PUBLIC_MAPBOX_TOKEN");return}if(M(e),r.current||!p.current)return;a.accessToken=e;const l=o.length>0?[o[0].lng,o[0].lat]:[-.1278,51.5074];try{r.current=new a.Map({container:p.current,style:"mapbox://styles/mapbox/light-v11",center:l,zoom:11,interactive:T}),r.current.addControl(new a.NavigationControl,"top-right"),r.current.on("load",()=>{d&&o.length>=2&&w(o,e)})}catch(x){console.error("Mapbox init error:",x),_("Failed to load map")}})(),()=>{r.current&&(r.current.remove(),r.current=null)}),[]),s.useEffect(()=>{if(r.current){if(o.forEach(t=>{new a.Marker({color:t.color||"#3b82f6"}).setLngLat([t.lng,t.lat]).setPopup(t.label?new a.Popup().setHTML(`<b>${t.label}</b>`):void 0).addTo(r.current)}),o.length>=1){const t=new a.LngLatBounds;o.forEach(e=>t.extend([e.lng,e.lat])),r.current.fitBounds(t,{padding:50})}d&&o.length>=2&&w(o)}},[g,i,u,d]);const w=async(t,e)=>{if(!r.current||(!e&&v&&(e=v),!e&&typeof a<"u"&&a.accessToken&&(e=a.accessToken),!e))return;const x=`https://api.mapbox.com/directions/v5/mapbox/driving/${t.map(c=>`${c.lng},${c.lat}`).join(";")}?geometries=geojson&access_token=${e}`;try{const m=(await(await fetch(x)).json()).routes?.[0]?.geometry;m&&(r.current.getSource("route")?r.current.getSource("route").setData({type:"Feature",properties:{},geometry:m}):r.current.addLayer({id:"route",type:"line",source:{type:"geojson",data:{type:"Feature",properties:{},geometry:m}},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3b82f6","line-width":5,"line-opacity":.75}}))}catch(c){console.error("Error fetching route:",c)}};return h?n.jsxs("div",{style:{height:b,width:"100%"},className:`bg-gray-100 flex flex-col items-center justify-center rounded-xl border border-gray-300 ${y} p-4`,children:[n.jsxs("div",{className:"text-center mb-4",children:[n.jsx("p",{className:"font-bold text-gray-500",children:"Map Unavailable"}),n.jsx("p",{className:"text-xs text-gray-400",children:h})]}),n.jsxs("div",{className:"w-full max-w-xs bg-white p-3 rounded shadow-sm border border-gray-200",children:[n.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Enter Token Manually:"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"text",value:f,onChange:t=>j(t.target.value),placeholder:"pk.eyJ1...",className:"flex-1 px-2 py-1.5 border border-gray-300 rounded text-xs w-full"}),n.jsx("button",{onClick:k,className:"px-3 py-1.5 bg-blue-600 text-white rounded text-xs font-bold hover:bg-blue-700 whitespace-nowrap",children:"Save"})]})]})]}):n.jsx("div",{className:`relative overflow-hidden rounded-xl ${y}`,children:n.jsx("div",{ref:p,style:{height:b,width:"100%"}})})}export{U as M};
