import{j as e,X as F,B as H,r as a,M as ce,a as P,P as X,d as Z}from"./index-5UJQZh1O.js";import{F as de,U as ee,c as xe,T as V,D as me,j as he,k as ue,C as se,L as pe,i as be}from"./badge-CFUPwwPp.js";import{C as O}from"./clock-BSTGw2vZ.js";import{M as K}from"./map-pin-CAk8qj7B.js";import{J as fe}from"./JobCard-7giTX0L1.js";import{A as Y,m as ge}from"./mapService-D7PuIvGV.js";import{P as te}from"./pen-line-B2laf6gf.js";import{C as je,M as ve,H as Ne}from"./App-CxomlPn2.js";import{P as we}from"./plus-C_zTDATH.js";import{T as ye}from"./trash-2-Dpg-LDaT.js";import{C as Ce}from"./circle-alert-B1diqlqF.js";import{a as ke}from"./auditLogger-XIHI3tGa.js";import{D as Se}from"./download-Iv45di7Q.js";import{C as le}from"./circle-x-DbKW_n_M.js";import{F as Ae}from"./funnel-O1tagNyY.js";import"./configService-Ux2mtHae.js";import"./mapboxConfig-B9kHtw8J.js";import"./trending-up-Dos6uxXs.js";import"./navigation-DtiQYTGD.js";function Je({job:t,isOpen:u,onClose:n,onAction:p}){if(!u)return null;const f=[{qty:3,name:"Television"},{qty:2,name:"Tool Box"},{qty:1,name:"Ironing Board"},{qty:6,name:"Tools"},{qty:1,name:"Garden Set"},{qty:1,name:"Coffee Table"},{qty:2,name:"Armchair"}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm z-50 transition-opacity",onClick:n}),e.jsxs("div",{className:"fixed inset-y-0 right-0 w-full md:w-[500px] bg-white shadow-2xl z-[60] flex flex-col animate-in slide-in-from-right duration-300",children:[e.jsxs("div",{className:"px-6 py-6 border-b border-slate-100 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs font-bold border border-slate-200",children:t.id}),e.jsx("a",{href:"#",className:"text-sm text-blue-500 hover:underline",children:"View listing page"})]}),e.jsx("button",{onClick:n,className:"p-1 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(F,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("h2",{className:"text-xl font-bold text-slate-900 leading-snug mb-1",children:[t.service||"3 Bed House"," / 2 People / 20.0 m³ to 24.0 m³"]}),e.jsx("p",{className:"text-slate-500 text-sm mb-4",children:new Date(t.date).toLocaleDateString("en-GB",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}),e.jsxs("div",{className:"text-2xl font-bold text-slate-900 mb-2",children:["£",t.customerPrice]}),e.jsx("p",{className:"text-slate-400 text-sm font-bold",children:"Admin"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"p-6 pb-0 flex gap-3",children:[e.jsx(H,{className:"flex-1 bg-[#2ea3f2] hover:bg-[#2589cc] text-white shadow-none font-bold",children:"Complete"}),e.jsx(H,{className:"flex-1 bg-[#2ea3f2] hover:bg-[#2589cc] text-white shadow-none font-bold",children:"Complete with issues"})]}),e.jsxs("div",{className:"p-6 space-y-3 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-[80px_1fr] items-baseline gap-2",children:[e.jsx("span",{className:"font-bold text-slate-900",children:"Vehicle"}),e.jsx("span",{className:"text-slate-600",children:t.driverName?"Luton Van":"No vehicle assigned"})]}),e.jsxs("div",{className:"grid grid-cols-[80px_1fr] items-baseline gap-2",children:[e.jsx("span",{className:"font-bold text-slate-900",children:"Driver"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-slate-600",children:t.driverName||"No driver assigned"}),e.jsx("a",{href:"#",className:"text-blue-500 hover:underline",children:"Change driver"})]})]}),e.jsxs("div",{className:"grid grid-cols-[80px_1fr] items-center gap-2",children:[e.jsx("span",{className:"font-bold text-slate-900",children:"Job sheet"}),e.jsxs("a",{href:"#",className:"text-blue-500 hover:underline flex items-center gap-1",children:[e.jsx(de,{className:"w-3.5 h-3.5"})," View Job Sheet"]})]}),e.jsxs("button",{className:"text-red-500 hover:underline text-sm mt-2 flex items-center gap-1",children:[e.jsx(F,{className:"w-3.5 h-3.5"})," Deallocate me"]})]}),e.jsx("div",{className:"px-6 pb-2",children:e.jsx("h3",{className:"text-slate-500 font-normal text-lg",children:"Job details"})}),e.jsxs("div",{className:"w-full h-64 bg-[#eef0f2] relative mb-6 border-y border-slate-200",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-30 pointer-events-none select-none overflow-hidden",children:e.jsxs("svg",{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("defs",{children:e.jsx("pattern",{id:"grid",width:"40",height:"40",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 40 0 L 0 0 0 40",fill:"none",stroke:"#cbd5e1",strokeWidth:"1"})})}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)"})]})}),e.jsx("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",children:e.jsx("path",{d:"M100 80 Q 250 150, 400 120",stroke:"#94a3b8",strokeWidth:"4",fill:"none",strokeDasharray:"8 4"})}),e.jsxs("div",{className:"absolute inset-0",children:[e.jsxs("div",{className:"absolute top-[80px] left-[100px] -translate-x-1/2 -translate-y-full flex flex-col items-center group cursor-pointer hover:z-10",children:[e.jsx("div",{className:`bg-orange-500 text-white w-8 h-10 flex items-center justify-center rounded shadow-lg font-bold text-sm relative z-10 
                                after:content-[''] after:absolute after:bottom-[-6px] after:left-1/2 after:-translate-x-1/2 after:border-[6px] after:border-transparent after:border-t-orange-500`,children:"1"}),e.jsxs("div",{className:"mt-2 bg-white px-2 py-1 rounded shadow-md text-xs font-bold text-slate-700 whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity absolute top-full",children:["Pickup: ",t.pickup.postcode]})]}),e.jsxs("div",{className:"absolute top-[120px] left-[400px] -translate-x-1/2 -translate-y-full flex flex-col items-center group cursor-pointer hover:z-10",children:[e.jsx("div",{className:`bg-lime-500 text-white w-8 h-10 flex items-center justify-center rounded shadow-lg font-bold text-sm relative z-10 
                                after:content-[''] after:absolute after:bottom-[-6px] after:left-1/2 after:-translate-x-1/2 after:border-[6px] after:border-transparent after:border-t-lime-500`,children:"2"}),e.jsxs("div",{className:"mt-2 bg-white px-2 py-1 rounded shadow-md text-xs font-bold text-slate-700 whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity absolute top-full",children:["Drop: ",t.delivery.postcode]})]})]}),e.jsxs("div",{className:"absolute bottom-4 right-4 flex flex-col gap-2",children:[e.jsx("button",{className:"w-8 h-8 bg-white rounded shadow text-slate-600 flex items-center justify-center hover:bg-slate-50 font-bold",children:"+"}),e.jsx("button",{className:"w-8 h-8 bg-white rounded shadow text-slate-600 flex items-center justify-center hover:bg-slate-50 font-bold",children:"-"})]})]}),e.jsxs("div",{className:"px-6 space-y-8 mb-8",children:[e.jsxs("div",{className:"grid grid-cols-[80px_1fr] gap-2",children:[e.jsx("span",{className:"font-bold text-slate-900",children:"Pickup"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 text-sm",children:[e.jsx(O,{className:"w-4 h-4 text-slate-400"}),e.jsxs("span",{children:[t.date,", ",t.time]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 text-sm",children:[e.jsx(K,{className:"w-4 h-4 text-slate-400"}),e.jsxs("span",{children:[t.pickup.address.split(",")[0],", ",t.pickup.postcode.split(" ")[0]]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 text-sm",children:[e.jsxs("div",{className:"w-4 h-4 flex flex-col justify-center gap-0.5",children:[e.jsx("div",{className:"h-0.5 w-2 bg-slate-400 ml-auto"}),e.jsx("div",{className:"h-0.5 w-4 bg-slate-400"})]}),e.jsx("span",{children:"Ground floor"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-[80px_1fr] gap-2",children:[e.jsx("span",{className:"font-bold text-slate-900",children:"Delivery"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 text-sm",children:[e.jsx(O,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{children:"Same day"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 text-sm",children:[e.jsx(K,{className:"w-4 h-4 text-slate-400"}),e.jsxs("span",{children:[t.delivery.address.split(",")[0],", ",t.delivery.postcode.split(" ")[0]]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 text-sm",children:[e.jsxs("div",{className:"w-4 h-4 flex flex-col justify-center gap-0.5",children:[e.jsx("div",{className:"h-0.5 w-2 bg-slate-400 ml-auto"}),e.jsx("div",{className:"h-0.5 w-4 bg-slate-400"})]}),e.jsx("span",{children:"Ground floor"})]})]})]})]}),e.jsxs("div",{className:"px-6 space-y-3 mb-8 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-[100px_1fr]",children:[e.jsx("span",{className:"font-bold text-slate-900",children:"Created"}),e.jsx("span",{className:"text-slate-600",children:"November 7, 2025"})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr]",children:[e.jsx("span",{className:"font-bold text-slate-900",children:"Distance"}),e.jsx("span",{className:"text-slate-600",children:"21 mile"})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr]",children:[e.jsx("span",{className:"font-bold text-slate-900",children:"Capacity"}),e.jsxs("span",{className:"text-slate-600",children:[t.capacity||"21.4","m³"]})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr]",children:[e.jsx("span",{className:"font-bold text-slate-900",children:"People"}),e.jsx("span",{className:"text-slate-600",children:"2"})]})]}),e.jsxs("div",{className:"px-6 pb-12",children:[e.jsx("h3",{className:"text-slate-500 font-normal text-lg mb-4",children:"Items"}),e.jsx("ul",{className:"space-y-2 text-sm text-slate-700",children:f.map((r,x)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"mt-1.5 w-1 h-1 bg-slate-400 rounded-full flex-shrink-0"}),e.jsxs("span",{children:[r.qty," x ",r.name]})]},x))})]})]})]})]})}function De({onClose:t,onSuccess:u}){const[n,p]=a.useState(1),[f,r]=a.useState(!1),[x,v]=a.useState({name:"",phone:"",email:""}),[m,N]=a.useState(null),[c,w]=a.useState(null),[h,_]=a.useState(null),[E,B]=a.useState(""),[y,L]=a.useState(""),[d,J]=a.useState([]),[g,D]=a.useState("Large Van"),[k,l]=a.useState(0),[i,C]=a.useState(""),[b,S]=a.useState(!1),[ae,ne]=a.useState(""),[M,q]=a.useState(""),[U,re]=a.useState("0.5"),[$,z]=a.useState("1");a.useEffect(()=>{async function s(){if(m&&c){r(!0);try{const o=await ge.calculateRoute(m,c);_(o)}catch(o){console.error("Route calc failed",o)}finally{r(!1)}}}s()},[m,c]),a.useEffect(()=>{if(h){const s=d.reduce((I,Q)=>I+Q.volume*Q.quantity,0),o=h.distanceMiles*1.5,j=s*20,A=Math.round((g==="Luton Van"?60:40)+o+j);l(A)}},[h,d,g]);const ie=()=>{if(!M)return;const s={id:Math.random().toString(36).substr(2,9),name:M,volume:parseFloat(U),quantity:parseInt($)};J([...d,s]),q(""),z("1")},oe=s=>{J(d.filter(o=>o.id!==s))},G=s=>{if(!m||!c||!x.name)return;const o=b&&i?parseFloat(i):k,j=d.reduce((A,I)=>A+I.volume*I.quantity,0),W={id:`JOB-${Math.floor(Math.random()*1e4)}`,status:s,date:E||new Date().toISOString().split("T")[0],time:y||"09:00",customerName:x.name,pickup:{address:m.address,postcode:m.postcode||"N/A",lat:m.lat,lng:m.lng},delivery:{address:c.address,postcode:c.postcode||"N/A",lat:c.lat,lng:c.lng},totalVolume:j,customerPrice:o,driverPrice:Math.round(o*.7),reference:`MAN-${Date.now().toString().slice(-6)}`,items:d.map(A=>A.name),vehicleType:g};console.log("Saving Job:",W),u()};return e.jsx("div",{className:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"bg-slate-900 text-white px-6 py-4 flex items-center justify-between shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-blue-400"}),"Manual Job Creation"]}),e.jsxs("p",{className:"text-slate-400 text-sm",children:["Step ",n," of 4"]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(F,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"h-1 bg-slate-100 w-full shrink-0",children:e.jsx("div",{className:"h-full bg-blue-600 transition-all duration-300 ease-out",style:{width:`${n/4*100}%`}})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[n===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 border-b pb-2",children:"Customer Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",value:x.name,onChange:s=>v({...x,name:s.target.value}),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"Jane Doe"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Phone Number"}),e.jsx("input",{type:"tel",value:x.phone,onChange:s=>v({...x,phone:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"+44 7000 000000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Email Address"}),e.jsx("input",{type:"email",value:x.email,onChange:s=>v({...x,email:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"jane@example.com"})]})]}),e.jsx("h3",{className:"text-lg font-bold text-slate-800 border-b pb-2 pt-4",children:"Schedule"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"date",value:E,onChange:s=>B(s.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Time Window"}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"time",value:y,onChange:s=>L(s.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]})]})]}),n===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 border-b pb-2",children:"Route Planning"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Pickup Address"}),e.jsx(Y,{placeholder:"Enter postcode or address...",defaultValue:m?.address,onSelect:(s,o,j)=>N({address:s,lat:o,lng:j})})]}),e.jsx("div",{className:"flex justify-center -my-2 relative z-10",children:e.jsx("div",{className:"bg-slate-100 p-1.5 rounded-full border border-slate-200",children:e.jsx(V,{className:"w-4 h-4 text-slate-400"})})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Delivery Address"}),e.jsx(Y,{placeholder:"Enter postcode or address...",defaultValue:c?.address,onSelect:(s,o,j)=>w({address:s,lat:o,lng:j})})]})]}),e.jsx("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200 mt-6",children:f?e.jsxs("div",{className:"flex items-center justify-center py-4 text-slate-500 gap-2",children:[e.jsx(je,{className:"w-4 h-4 animate-spin"}),"Calculating route..."]}):h?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Estimated Distance"}),e.jsxs("p",{className:"text-xl font-bold text-slate-900",children:[h.distanceMiles," miles"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Est. Travel Time"}),e.jsxs("p",{className:"text-xl font-bold text-slate-900",children:[h.durationMinutes," mins"]})]})]}):e.jsx("div",{className:"text-center py-4 text-slate-400 italic",children:"Enter both addresses to calculate route"})})]}),n===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 border-b pb-2",children:"Vehicle & Items"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Required Vehicle"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:["Medium Van","Large Van","Luton Van"].map(s=>e.jsxs("button",{onClick:()=>D(s),className:`p-3 rounded-xl border-2 text-center transition-all ${g===s?"border-blue-500 bg-blue-50 text-blue-700 font-bold":"border-slate-200 hover:border-blue-300"}`,children:[e.jsx(V,{className:`w-6 h-6 mx-auto mb-2 ${g===s?"text-blue-600":"text-slate-400"}`}),e.jsx("span",{className:"text-sm block",children:s})]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Inventory"}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("input",{placeholder:"Item name (e.g. Sofa)",value:M,onChange:s=>q(s.target.value),className:"flex-1 px-3 py-2 border rounded-lg text-sm"}),e.jsxs("select",{value:U,onChange:s=>re(s.target.value),className:"w-24 px-2 py-2 border rounded-lg text-sm",children:[e.jsx("option",{value:"0.1",children:"Sm"}),e.jsx("option",{value:"0.5",children:"Med"}),e.jsx("option",{value:"1.0",children:"Lg"}),e.jsx("option",{value:"1.5",children:"XL"})]}),e.jsx("input",{type:"number",value:$,onChange:s=>z(s.target.value),className:"w-16 px-2 py-2 border rounded-lg text-sm text-center",min:"1"}),e.jsx("button",{onClick:ie,className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:e.jsx(we,{className:"w-5 h-5"})})]}),d.length>0?e.jsx("div",{className:"bg-slate-50 rounded-lg border border-slate-200 max-h-40 overflow-y-auto divide-y",children:d.map(s=>e.jsxs("div",{className:"p-3 flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"font-medium text-slate-700",children:[s.quantity,"x ",s.name]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-slate-500 text-xs",children:[(s.volume*s.quantity).toFixed(1)," m³"]}),e.jsx("button",{onClick:()=>oe(s.id),className:"text-red-500 hover:text-red-700",children:e.jsx(ye,{className:"w-4 h-4"})})]})]},s.id))}):e.jsx("div",{className:"text-center p-6 bg-slate-50 rounded-lg border border-dashed border-slate-300 text-slate-400 text-sm",children:"No items added yet"})]})]}),n===4&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 border-b pb-2",children:"Quote & Review"}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-6 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-blue-800 font-medium",children:"Calculated System Price"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-900",children:["£",k.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-700/80 mb-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Base Fare (",g,")"]}),e.jsx("span",{children:"included"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Distance (",h?.distanceMiles," mi)"]}),e.jsxs("span",{children:["+£",((h?.distanceMiles||0)*1.5).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Volume"}),e.jsxs("span",{children:["+£",d.reduce((s,o)=>s+o.volume*o.quantity*20,0).toFixed(2)]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"checkbox",id:"override",checked:b,onChange:s=>S(s.target.checked),className:"rounded text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"override",className:"text-sm font-bold text-blue-900 cursor-pointer",children:"Manual Price Override"})]}),b&&e.jsx("div",{className:"animate-in slide-in-from-top-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(me,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"number",value:i,onChange:s=>C(s.target.value),placeholder:"0.00",className:"w-full pl-9 pr-4 py-2 rounded-lg border border-blue-200 focus:border-blue-500 outline-none"})]}),e.jsx("input",{type:"text",placeholder:"Reason (e.g. VIP Customer)",value:ae,onChange:s=>ne(s.target.value),className:"flex-[2] px-4 py-2 rounded-lg border border-blue-200 focus:border-blue-500 outline-none"})]})})]})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200 flex gap-3 text-sm text-yellow-800",children:[e.jsx(Ce,{className:"w-5 h-5 shrink-0"}),e.jsx("p",{children:"Review all details before publishing. Once published, the job will be visible to drivers or assigned automatically based on settings."})]})]})]}),e.jsxs("div",{className:"bg-slate-50 px-6 py-4 border-t border-slate-200 flex justify-between shrink-0",children:[n>1?e.jsxs("button",{onClick:()=>p(n-1),className:"px-4 py-2 text-slate-600 hover:bg-slate-200 rounded-lg font-medium flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"Back"]}):e.jsx("div",{}),e.jsx("div",{className:"flex gap-3",children:n<4?e.jsxs("button",{onClick:()=>p(n+1),className:"px-6 py-2 bg-slate-900 text-white hover:bg-slate-800 rounded-lg font-medium flex items-center gap-2",children:["Next Step",e.jsx(ue,{className:"w-4 h-4"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>G("draft"),className:"px-4 py-2 bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 rounded-lg font-medium",children:"Save as Draft"}),e.jsxs("button",{onClick:()=>G("available"),className:"px-6 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg font-bold flex items-center gap-2 shadow-lg hover:shadow-xl transition-all",children:[e.jsx(se,{className:"w-4 h-4"}),"Publish Job"]})]})})]})]})})}let R={name:"Admin Owner",role:"owner",email:"admin@shiftmyhome.co.uk"};const Ie={PROCESS_REFUND:["owner","finance_admin"],APPROVE_PAYOUT:["owner","finance_admin"],VIEW_FINANCIALS:["owner","finance_admin"],EDIT_PRICING:["owner","finance_admin"],CREATE_JOB:["owner","operations","support"],EDIT_JOB_DETAILS:["owner","operations","support"],CANCEL_JOB:["owner","operations"],DELETE_JOB:["owner"],ASSIGN_DRIVER:["owner","operations"],DEALLOCATE_JOB:["owner","operations"],VIEW_AUDIT_LOGS:["owner","finance_admin","operations","support"],MANAGE_USERS:["owner"]},T={getUser:()=>R,switchUser:t=>{R={name:{owner:"Admin Owner",finance_admin:"Mike Finance",operations:"Sarah Ops",support:"Tom Support",viewer:"Guest Viewer"}[t],role:t,email:`${t}@shiftmyhome.co.uk`},window.location.reload()},hasPermission:t=>Ie[t].includes(R.role)},Pe=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("polygon",{points:"12 2 2 7 12 12 22 7 12 2"}),e.jsx("polyline",{points:"2 17 12 22 22 17"}),e.jsx("polyline",{points:"2 12 12 17 22 12"})]}),_e=[{id:"1",name:"Mike Johnson",username:"mike.j_driver",phone:"07700 900111",vehicle:"Large Van",status:"available"},{id:"2",name:"Sarah Davis",username:"sarah.d_logistics",phone:"07700 900222",vehicle:"Medium Van",status:"on-job"},{id:"3",name:"Tom Wilson",username:"tom_transport",phone:"07700 900333",vehicle:"Luton Van",status:"available"},{id:"4",name:"James Brown",username:"j.brown_exp",phone:"07700 900444",vehicle:"Small Van",status:"available"}];function Ee({onClose:t,onAssign:u}){const[n,p]=a.useState(""),f=_e.filter(r=>r.name.toLowerCase().includes(n.toLowerCase())||r.vehicle.toLowerCase().includes(n.toLowerCase()));return e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-900",children:"Select Driver"}),e.jsx("button",{onClick:t,children:e.jsx(le,{className:"w-6 h-6 text-slate-400 hover:text-slate-600"})})]}),e.jsx("div",{className:"p-4 border-b border-slate-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{className:"w-full pl-9 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Search drivers...",value:n,onChange:r=>p(r.target.value)})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto max-h-[400px]",children:f.map(r=>e.jsxs("button",{onClick:()=>u(r),className:"w-full p-4 flex items-center justify-between hover:bg-slate-50 border-b border-slate-50 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold ${r.status==="available"?"bg-green-500":"bg-slate-400"}`,children:r.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900",children:r.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:[r.vehicle," • ",r.status]})]})]}),e.jsx("div",{className:"px-3 py-1 bg-blue-50 text-blue-600 rounded-lg text-xs font-bold",children:"Select"})]},r.id))})]})})}function Ze(){const[t,u]=a.useState("all"),[n,p]=a.useState(null),[f,r]=a.useState(""),[x,v]=a.useState(null),[m,N]=a.useState(!1),[c,w]=a.useState("all"),[h,_]=a.useState([]),{addJobToJourney:E,isJobInJourney:B}=ce(),y=T.getUser(),L=T.hasPermission("CREATE_JOB"),d=()=>{const l=P.getAllJobs(),i={...l[0],id:"DRAFT-001",status:"draft",reference:"DRAFT-REF-1",customerName:"Pending Customer",pickup:{...l[0]?.pickup,address:"TBD"},date:"2024-01-01"},C={...l[0],id:"FAIL-001",status:"failed",reference:"FAIL-REF-1",customerName:"Angry Customer",date:"2023-12-25"},b=[...l];b.find(S=>S.id==="DRAFT-001")||b.push(i),b.find(S=>S.id==="FAIL-001")||b.push(C),_(b)};a.useEffect(()=>{d();const l=["job_created","job_accepted","job_status_changed","job_assigned"];return l.forEach(i=>P.on(i,d)),()=>l.forEach(i=>P.off(i,d))},[]);const J=()=>{N(!1),d()},g=l=>{if(!n)return;P.assignJob(n,l)?(ke.log({user:y.name,role:y.role,action:"Driver Assigned",details:`Assigned driver ${l.name} to job`,jobId:n,type:"update"}),d(),p(null)):alert("Failed to assign driver. Please try again.")},D=h.filter(l=>{if(t!=="all"){if(t==="history"){if(!["completed","cancelled","de-allocated","failed"].includes(l.status))return!1}else if(t==="in-progress"){if(!["in-transit","picked-up","in-progress"].includes(l.status))return!1}else if(l.status!==t)return!1}if((t==="de-allocated"||t==="cancelled"||t==="history")&&c!=="all"){const C=l.customerPrice>0;if(c==="charged"&&!C||c==="no-charge"&&C)return!1}const i=f.toLowerCase();return l.reference?.toLowerCase().includes(i)||l.customerName?.toLowerCase().includes(i)||l.pickup.address.toLowerCase().includes(i)||l.delivery.address.toLowerCase().includes(i)||l.id.toLowerCase().includes(i)}),k=[{id:"all",label:"All Jobs",icon:Pe},{id:"available",label:"Available",icon:X},{id:"assigned",label:"Assigned",icon:ee},{id:"in-journey",label:"In Journey",icon:ve},{id:"in-progress",label:"In Progress",icon:V},{id:"completed",label:"Completed",icon:se},{id:"de-allocated",label:"De-allocated",icon:be},{id:"cancelled",label:"Cancelled",icon:le},{id:"history",label:"Job History & Charges",icon:Ne}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900",children:"Jobs Management"}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Full lifecycle control: Draft → Assigned → Paid → Completed"})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 mr-2 bg-slate-50 px-2 py-1 rounded-lg border border-slate-200",children:[e.jsx("span",{className:"text-xs text-slate-500 font-medium",children:"Role:"}),e.jsxs("select",{className:"text-xs bg-transparent border-none outline-none font-bold text-slate-700 cursor-pointer",value:y.role,onChange:l=>T.switchUser(l.target.value),children:[e.jsx("option",{value:"owner",children:"Owner"}),e.jsx("option",{value:"finance_admin",children:"Finance Admin"}),e.jsx("option",{value:"operations",children:"Operations"}),e.jsx("option",{value:"support",children:"Support"}),e.jsx("option",{value:"viewer",children:"Viewer"})]})]}),L?e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-xl transition-all shadow-md",children:[e.jsx(te,{className:"w-4 h-4"}),"Create Job"]}):e.jsxs("button",{disabled:!0,className:"flex items-center gap-2 px-4 py-2 bg-slate-100 text-slate-400 rounded-xl cursor-not-allowed",children:[e.jsx(pe,{className:"w-4 h-4"}),"Create Job"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl transition-all",children:[e.jsx(Se,{className:"w-5 h-5"}),"Export"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white p-2 rounded-xl shadow-sm border border-slate-200 overflow-x-auto",children:e.jsx("div",{className:"flex gap-2 min-w-max",children:k.map(l=>e.jsxs("button",{onClick:()=>{u(l.id),w("all")},className:`px-4 py-2.5 rounded-lg font-medium text-sm transition-all flex items-center gap-2 ${t===l.id?"bg-slate-900 text-white shadow-md":"text-slate-500 hover:bg-slate-50 hover:text-slate-900"}`,children:[e.jsx(l.icon,{className:"w-4 h-4"}),l.label]},l.id))})}),(t==="de-allocated"||t==="cancelled"||t==="history")&&e.jsxs("div",{className:"flex items-center gap-3 animate-in fade-in slide-in-from-top-2",children:[e.jsx("span",{className:"text-sm font-bold text-slate-500 uppercase tracking-wide",children:"Charge Filter:"}),e.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>w("all"),className:`px-3 py-1 text-xs font-bold rounded-md transition-all ${c==="all"?"bg-white shadow text-slate-900":"text-slate-500 hover:text-slate-700"}`,children:"All"}),e.jsx("button",{onClick:()=>w("charged"),className:`px-3 py-1 text-xs font-bold rounded-md transition-all ${c==="charged"?"bg-white shadow text-green-700":"text-slate-500 hover:text-slate-700"}`,children:"With Charge"}),e.jsx("button",{onClick:()=>w("no-charge"),className:`px-3 py-1 text-xs font-bold rounded-md transition-all ${c==="no-charge"?"bg-white shadow text-slate-900":"text-slate-500 hover:text-slate-700"}`,children:"No Charge"})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Z,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search jobs by reference, customer, postcode, or ID...",value:f,onChange:l=>r(l.target.value),className:"w-full pl-12 pr-4 py-3 rounded-xl border border-slate-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none bg-white shadow-sm"})]}),e.jsxs("button",{className:"px-4 py-2 bg-white border border-slate-300 rounded-xl hover:bg-slate-50 text-slate-700 flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5"}),"Advanced Filter"]})]}),e.jsx("div",{className:"flex flex-col gap-3",children:D.length===0?e.jsxs("div",{className:"bg-slate-50 rounded-xl border border-dashed border-slate-300 p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-200 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(X,{className:"w-8 h-8 text-slate-400"})}),e.jsx("h3",{className:"text-lg font-bold text-slate-700",children:"No jobs found"}),e.jsxs("p",{className:"text-slate-500 max-w-sm mx-auto mt-2",children:["There are no jobs matching the current filter",e.jsxs("span",{className:"font-bold px-2",children:['"',t!=="all"?k.find(l=>l.id===t)?.label:"All",'"']}),"and search criteria."]}),e.jsx("button",{onClick:()=>N(!0),className:"mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700",children:"Create New Job"})]}):D.map(l=>e.jsx(fe,{job:l,onClick:()=>v(l)},l.id))}),x&&e.jsx(Je,{job:x,isOpen:!!x,onClose:()=>v(null),onAction:(l,i)=>{console.log("Action trigger:",l,i),l==="assign"&&p(i)}}),m&&e.jsx(De,{onClose:()=>N(!1),onSuccess:J}),n&&e.jsx(Ee,{onClose:()=>p(null),onAssign:g})]})}export{Ze as JobsManagement};
